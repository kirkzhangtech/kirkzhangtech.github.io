
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Eden">
    <title>Archives: 2022/8 - Eden</title>
    <meta name="author" content="kirkzhang">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Eden">
<meta property="og:url" content="https://simonteo58.github.io/archives/2022/08/index.html">
<meta property="og:site_name" content="Eden">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="kirkzhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@nil">
    
        <link rel="publisher" href="https://plus.google.com/nil"/>
    
    
        
    
    
        <meta property="og:image" content="https://simonteo58.github.io/assets/images/nil"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-jtle2hiadqi6creqze7vuhnn9ct7bmrwzzyznr4cpumzvckdy7pw9sbtrdse.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Eden
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/nil" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/nil" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">kirkzhang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/nil"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/31/oracle/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA_Oracle_DBA_%E5%85%A5%E9%97%A8_%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%AF%8A%E6%96%AD%E6%A1%88%E4%BE%8B/"
                            aria-label=": æ·±å…¥æµ…å‡º_Oracle_DBA_å…¥é—¨_è¿›é˜¶ä¸è¯Šæ–­æ¡ˆä¾‹"
                        >
                            æ·±å…¥æµ…å‡º_Oracle_DBA_å…¥é—¨_è¿›é˜¶ä¸è¯Šæ–­æ¡ˆä¾‹
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-31T17:35:04+08:00">
	
		    Aug 31, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/oracle/">oracle</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="1-æ•°æ®åº“é¢å¯åŠ¨ä¸å…³é—­"><a href="#1-æ•°æ®åº“é¢å¯åŠ¨ä¸å…³é—­" class="headerlink" title="1. æ•°æ®åº“é¢å¯åŠ¨ä¸å…³é—­"></a>1. æ•°æ®åº“é¢å¯åŠ¨ä¸å…³é—­</h1><p>oracle serveråˆ†ä¸ºä¸¤éƒ¨åˆ†(database: è¿™éƒ¨åˆ†æ˜¯æŒ‡æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ•°æ®ï¼Œinstanceåˆ™æ˜¯æŒ‡åå°è¿è¡Œçš„çº¿ç¨‹å’Œéƒ¨åˆ†å…±äº«å†…å­˜)ã€‚<br>å¹¶ä¸”æ•°æ®å¯åŠ¨åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š1. <code>nomount</code>  2. <code>mount</code>  3. <code>open</code> çŠ¶æ€</p>
<ol>
<li>å¯åŠ¨åˆ°nomountçŠ¶æ€</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/31/oracle/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA_Oracle_DBA_%E5%85%A5%E9%97%A8_%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%AF%8A%E6%96%AD%E6%A1%88%E4%BE%8B/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/27/archive/Api%E6%95%B0%E6%8D%AE%E8%87%AA%E5%8A%A8%E5%85%A5%E5%BA%93/"
                            aria-label=": APIæ•°æ®è‡ªåŠ¨å…¥åº“"
                        >
                            APIæ•°æ®è‡ªåŠ¨å…¥åº“
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-27T13:35:51+08:00">
	
		    Aug 27, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/archive/">archive</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>åŸæ–‡é“¾æ¥ : <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44723724/article/details/125600165">https://blog.csdn.net/weixin_44723724/article/details/125600165</a></p>
</blockquote>
<h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>å°†ä¸åŒæ¸ é“çš„apiæ—¥å¿—å…¥åº“ï¼Œæ–¹ä¾¿æ—¥ååˆ†æå’Œæ£€æŸ¥ç³»ç»Ÿè¡Œä¸º</p>
<h2 id="æŒ‘æˆ˜"><a href="#æŒ‘æˆ˜" class="headerlink" title="æŒ‘æˆ˜"></a>æŒ‘æˆ˜</h2><ol>
<li>apiè¿”å›æ•°æ®æ ¼å¼å¤šæ ·ã€‚éœ€è¦ç¡®å®šä»¥ä»€ä¹ˆæ ·çš„å½¢å¼å‘ˆç°æ•°æ®ï¼Œå®šä¹‰è¡¨ç»“æ„.</li>
<li>jsonæ ¼å¼çš„åµŒå¥—é—®é¢˜.é€šè¿‡é¢å¤–å®šä¹‰è¡¨è¿›è¡Œå…³è”.<ol>
<li>å•è¡¨å½¢å¼<ul>
<li>jsonå­—æ®µå°±æ˜¯è¡¨å­—æ®µ</li>
</ul>
</li>
<li>å¤šè¡¨è¯¦ç»†å­˜å‚¨<ul>
<li>å…³è”å­—æ®µé€šè¿‡å¤–å±‚è¡¨åæ‹¼æ¥å†…å±‚è¡¨å</li>
<li>è§£æ json çš„æ—¶å€™ï¼Œéœ€è¦æŠŠå…³è”é”®å’Œå…³è”é”®çš„å€¼ä¼ é€’è¿›å»ï¼Œå…³è”é”®çš„å€¼ä¼ é€’çš„å°±æ˜¯å¤–å±‚è¡¨å½“å‰è¡Œæ•°æ®çš„ md5 å€¼ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†å¤šè¡¨ä¹‹é—´è¡Œæ•°æ®å…³è”çš„ä¾æ®</li>
</ul>
</li>
</ol>
</li>
<li>æœ¬åœ°å¤šç§æ•°æ®æº(ä¸åŒç§æ•°æ®åº“).</li>
<li>é€šè¿‡md5å€¼è§£å†³å¹‚ç­‰é—®é¢˜ï¼Œå¦‚æœå¯¼å…¥åŒä¸€æ‰¹æ•°æ®å°±åªæ˜¯æ›´æ–°å¯¼å…¥æ—¶é—´</li>
</ol>
<h2 id="ä»£ç è®¾è®¡"><a href="#ä»£ç è®¾è®¡" class="headerlink" title="ä»£ç è®¾è®¡"></a>ä»£ç è®¾è®¡</h2><ol>
<li>å·¥å‚æ¨¡å¼ : é€‚é…ä¸åŒç§æ•°æ®æº</li>
<li>æŠ½è±¡sqlæ„å»ºæ¨¡å‹ : å°†æ„å»ºsqlæ—¶å…¬å…±çš„ä»£ç è¿›è¡ŒæŠ½è±¡,å®šä¹‰æŠ½è±¡ç±».<ul>
<li>å›ºå®šè¡¨å</li>
<li>åˆ—ä¿¡æ¯</li>
<li>å…³è”é”®</li>
<li>æ•°æ®é›†åˆ</li>
</ul>
</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/27/archive/Api%E6%95%B0%E6%8D%AE%E8%87%AA%E5%8A%A8%E5%85%A5%E5%BA%93/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/26/archive/%E5%86%85%E5%AD%98%E9%AB%98%E6%95%88golang/"
                            aria-label=": å†…å­˜é«˜æ•ˆgolang"
                        >
                            å†…å­˜é«˜æ•ˆgolang
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-26T21:18:06+08:00">
	
		    Aug 26, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/archive/">archive</a>, <a class="category-link" href="/categories/archive/golang/">golang</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>åŸæ–‡é“¾æ¥ : <a target="_blank" rel="noopener" href="https://dev.to/deadlock/golang-writing-memory-efficient-and-cpu-optimized-go-structs-2ick">https://dev.to/deadlock/golang-writing-memory-efficient-and-cpu-optimized-go-structs-2ick</a></p>
</blockquote>
<h1 id="Golangç¼–å†™å†…å­˜é«˜æ•ˆå’ŒCPUä¼˜åŒ–çš„Goç»“æ„"><a href="#Golangç¼–å†™å†…å­˜é«˜æ•ˆå’ŒCPUä¼˜åŒ–çš„Goç»“æ„" class="headerlink" title="Golangç¼–å†™å†…å­˜é«˜æ•ˆå’ŒCPUä¼˜åŒ–çš„Goç»“æ„"></a>Golangç¼–å†™å†…å­˜é«˜æ•ˆå’ŒCPUä¼˜åŒ–çš„Goç»“æ„</h1><p>ç»“æ„æ˜¯ä¸€ä¸ªç±»å‹åŒ–çš„fieldé›†åˆï¼Œå¯¹äºå°†æ•°æ®åˆ†ç»„è®°å½•éå¸¸æœ‰ç”¨ã€‚è¿™ä½¿å¾—ä¸ä¸€ä¸ª<code>strcut</code>æœ‰å…³çš„æ‰€æœ‰æ•°æ®éƒ½è¢«æ•´é½åœ°å°è£…åœ¨ä¸€ä¸ªè½»é‡çº§çš„ç±»å‹å®šä¹‰ä¸­ï¼Œç„¶åå¯ä»¥é€šè¿‡å®šä¹‰ç»“æ„ç±»å‹ä¸Šçš„å‡½æ•°æ¥å®ç°è¡Œä¸ºã€‚</p>
<p>è¿™ç¯‡åšå®¢æˆ‘å°†å°è¯•è§£é‡Šæˆ‘ä»¬å¦‚ä½•åœ¨å†…å­˜ä½¿ç”¨å’ŒCPUå‘¨æœŸæ–¹é¢æœ‰æ•ˆåœ°ç¼–å†™ç»“æ„ã€‚</p>
<p>è®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢è¿™ä¸ªç»“æ„ï¼Œä¸ºæˆ‘çš„ä¸€äº›å¥‡æ€ªçš„ç”¨ä¾‹å®šä¹‰ç•¸å½¢èµ„æºç±»å‹ã€‚</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">type TerraformResource struct &#123;
  Cloud                string                       &#x2F;&#x2F; 16 bytes
  Name                 string                       &#x2F;&#x2F; 16 bytes
  HaveDSL              bool                         &#x2F;&#x2F;  1 byte
  PluginVersion        string                       &#x2F;&#x2F; 16 bytes
  IsVersionControlled  bool                         &#x2F;&#x2F;  1 byte
  TerraformVersion     string                       &#x2F;&#x2F; 16 bytes
  ModuleVersionMajor   int32                        &#x2F;&#x2F;  4 bytes
&#125;
</code></pre>
<p>è®©æˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç çœ‹çœ‹TerraformResourceç»“æ„éœ€è¦å¤šå°‘å†…å­˜åˆ†é…ã€‚</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">
package main

import &quot;fmt&quot;
import &quot;unsafe&quot;

type TerraformResource struct &#123;
  Cloud                string                       &#x2F;&#x2F; 16 bytes
  Name                 string                       &#x2F;&#x2F; 16 bytes
  HaveDSL              bool                         &#x2F;&#x2F;  1 byte
  PluginVersion        string                       &#x2F;&#x2F; 16 bytes
  IsVersionControlled  bool                         &#x2F;&#x2F;  1 byte
  TerraformVersion     string                       &#x2F;&#x2F; 16 bytes
  ModuleVersionMajor   int32                        &#x2F;&#x2F;  4 bytes
&#125;

func main() &#123;
    var d TerraformResource
    d.Cloud &#x3D; &quot;aws&quot;
    d.Name &#x3D; &quot;ec2&quot;
    d.HaveDSL &#x3D; true
    d.PluginVersion &#x3D; &quot;3.64&quot;
    d.TerraformVersion &#x3D; &quot;1.1&quot;
    d.ModuleVersionMajor &#x3D; 1
    d.IsVersionControlled &#x3D; true
    fmt.Println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)
    fmt.Printf(&quot;Total Memory Usage StructType:d %T &#x3D;&gt; [%d]\n&quot;, d, unsafe.Sizeof(d))
    fmt.Println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)
    fmt.Printf(&quot;Cloud Field StructType:d.Cloud %T &#x3D;&gt; [%d]\n&quot;, d.Cloud, unsafe.Sizeof(d.Cloud))
    fmt.Printf(&quot;Name Field StructType:d.Name %T &#x3D;&gt; [%d]\n&quot;, d.Name, unsafe.Sizeof(d.Name))
    fmt.Printf(&quot;HaveDSL Field StructType:d.HaveDSL %T &#x3D;&gt; [%d]\n&quot;, d.HaveDSL, unsafe.Sizeof(d.HaveDSL))
    fmt.Printf(&quot;PluginVersion Field StructType:d.PluginVersion %T &#x3D;&gt; [%d]\n&quot;, d.PluginVersion, unsafe.Sizeof(d.PluginVersion))
    fmt.Printf(&quot;ModuleVersionMajor Field StructType:d.IsVersionControlled %T &#x3D;&gt; [%d]\n&quot;, d.IsVersionControlled, unsafe.Sizeof(d.IsVersionControlled))
    fmt.Printf(&quot;TerraformVersion Field StructType:d.TerraformVersion %T &#x3D;&gt; [%d]\n&quot;, d.TerraformVersion, unsafe.Sizeof(d.TerraformVersion))
    fmt.Printf(&quot;ModuleVersionMajor Field StructType:d.ModuleVersionMajor %T &#x3D;&gt; [%d]\n&quot;, d.ModuleVersionMajor, unsafe.Sizeof(d.ModuleVersionMajor))  
&#125;</code></pre>
<p>outputå¦‚ä¸‹</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Total Memory Usage StructType:d main.TerraformResource &#x3D;&gt; [88]
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Cloud Field StructType:d.Cloud string &#x3D;&gt; [16]
Name Field StructType:d.Name string &#x3D;&gt; [16]
HaveDSL Field StructType:d.HaveDSL bool &#x3D;&gt; [1]
PluginVersion Field StructType:d.PluginVersion string &#x3D;&gt; [16]
ModuleVersionMajor Field StructType:d.IsVersionControlled bool &#x3D;&gt; [1]
TerraformVersion Field StructType:d.TerraformVersion string &#x3D;&gt; [16]
ModuleVersionMajor Field StructType:d.ModuleVersionMajor int32 &#x3D;&gt; [4]</code></pre>
<p>æ‰€ä»¥TerraformResourceç»“æ„éœ€è¦çš„æ€»å†…å­˜åˆ†é…æ˜¯88å­—èŠ‚ã€‚è¿™å°±æ˜¯TerraformResourceç±»å‹çš„å†…å­˜åˆ†é…æƒ…å†µ<br><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--HubwVUeX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/kodelint/blog-assets/raw/main/images/01-golang-struct-memory-map.jpeg" alt="TerraformResourceç±»å‹çš„å†…å­˜åˆ†é…æƒ…å†µ"></p>
<p>ä½†ä¸ºä»€ä¹ˆä¼šæœ‰88ä¸ªå­—èŠ‚ï¼Œ16+16+1+16+1+16+4&#x3D;70ä¸ªå­—èŠ‚ï¼Œè¿™é¢å¤–çš„18ä¸ªå­—èŠ‚ä»ä½•è€Œæ¥ï¼Ÿ</p>
<p>å½“æ¶‰åŠåˆ°ç»“æ„ä½“çš„å†…å­˜åˆ†é…æ—¶ï¼Œå®ƒä»¬æ€»æ˜¯è¢«åˆ†é…ä¸ºè¿ç»­çš„ã€å­—èŠ‚å¯¹é½çš„å†…å­˜å—ï¼Œå¹¶ä¸”å­—æ®µæ˜¯æŒ‰ç…§å®ƒä»¬è¢«å®šä¹‰çš„é¡ºåºåˆ†é…å’Œå­˜å‚¨çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>å­—èŠ‚å¯¹é½</strong>çš„æ¦‚å¿µæ„å‘³ç€è¿ç»­çš„å†…å­˜å—ä»¥ä¸å¹³å°å­—å¤§å°ç›¸åŒçš„åç§»é‡å¯¹é½ã€‚<br><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--S_4mkd0a--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/kodelint/blog-assets/raw/main/images/02-golang-struct-memory-map.jpeg"></p>
<p>æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒTerraformResource.HaveDSL , TerraformResource.isVersionControlledå’ŒTerraformResource.ModuleVersionMajoråˆ†åˆ«åªå ç”¨äº†1ä¸ªå­—èŠ‚ã€1ä¸ªå­—èŠ‚å’Œ4ä¸ªå­—èŠ‚ã€‚å…¶ä½™çš„ç©ºé—´éƒ½æ˜¯ç”¨ç©ºçš„ç„Šç›˜å­—èŠ‚å¡«å……çš„ã€‚</p>
<p>æ‰€ä»¥å›åˆ°åŒæ ·çš„æ•°å­¦é—®é¢˜ä¸Š</p>
<blockquote>
<p>åˆ†é…å­—èŠ‚&#x3D;16å­—èŠ‚+16å­—èŠ‚+1å­—èŠ‚+16å­—èŠ‚+1å­—èŠ‚+16å­—èŠ‚+4å­—èŠ‚<br>ç©ºå«å­—èŠ‚&#x3D;7å­—èŠ‚+7å­—èŠ‚+4å­—èŠ‚&#x3D;18å­—èŠ‚<br>æ€»å­—èŠ‚æ•°&#x3D;åˆ†é…å­—èŠ‚æ•°+ç©ºå«å­—èŠ‚æ•°&#x3D;70å­—èŠ‚+18å­—èŠ‚&#x3D;88å­—èŠ‚</p>
</blockquote>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿé€šè¿‡é€‚å½“çš„æ•°æ®ç»“æ„è°ƒæ•´ï¼Œå¦‚æœæˆ‘ä»¬é‡æ–°å®šä¹‰æˆ‘ä»¬çš„ç»“æ„ï¼Œå°±åƒè¿™æ ·</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">type TerraformResource struct &#123;
  Cloud                string                       &#x2F;&#x2F; 16 bytes
  Name                 string                       &#x2F;&#x2F; 16 bytes
  PluginVersion        string                       &#x2F;&#x2F; 16 bytes
  TerraformVersion     string                       &#x2F;&#x2F; 16 bytes
  ModuleVersionMajor   int32                        &#x2F;&#x2F;  4 bytes
  HaveDSL              bool                         &#x2F;&#x2F;  1 byte
  IsVersionControlled  bool                         &#x2F;&#x2F;  1 byte
&#125;
</code></pre>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">package main

import &quot;fmt&quot;
import &quot;unsafe&quot;

type TerraformResource struct &#123;
  Cloud                string                       &#x2F;&#x2F; 16 bytes
  Name                 string                       &#x2F;&#x2F; 16 bytes
  PluginVersion        string                       &#x2F;&#x2F; 16 bytes
  TerraformVersion     string                       &#x2F;&#x2F; 16 bytes
  ModuleVersionMajor   int32                        &#x2F;&#x2F;  4 bytes
  HaveDSL              bool                         &#x2F;&#x2F;  1 byte
  IsVersionControlled  bool                         &#x2F;&#x2F;  1 byte
&#125;

func main() &#123;
    var d TerraformResource
    d.Cloud &#x3D; &quot;aws&quot;
    d.Name &#x3D; &quot;ec2&quot;
    d.HaveDSL &#x3D; true
    d.PluginVersion &#x3D; &quot;3.64&quot;
    d.TerraformVersion &#x3D; &quot;1.1&quot;
    d.ModuleVersionMajor &#x3D; 1
    d.IsVersionControlled &#x3D; true
    fmt.Println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)
    fmt.Printf(&quot;Total Memory Usage StructType:d %T &#x3D;&gt; [%d]\n&quot;, d, unsafe.Sizeof(d))
    fmt.Println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;)
    fmt.Printf(&quot;Cloud Field StructType:d.Cloud %T &#x3D;&gt; [%d]\n&quot;, d.Cloud, unsafe.Sizeof(d.Cloud))
    fmt.Printf(&quot;Name Field StructType:d.Name %T &#x3D;&gt; [%d]\n&quot;, d.Name, unsafe.Sizeof(d.Name))
    fmt.Printf(&quot;HaveDSL Field StructType:d.HaveDSL %T &#x3D;&gt; [%d]\n&quot;, d.HaveDSL, unsafe.Sizeof(d.HaveDSL))
    fmt.Printf(&quot;PluginVersion Field StructType:d.PluginVersion %T &#x3D;&gt; [%d]\n&quot;, d.PluginVersion, unsafe.Sizeof(d.PluginVersion))
    fmt.Printf(&quot;ModuleVersionMajor Field StructType:d.IsVersionControlled %T &#x3D;&gt; [%d]\n&quot;, d.IsVersionControlled, unsafe.Sizeof(d.IsVersionControlled))
    fmt.Printf(&quot;TerraformVersion Field StructType:d.TerraformVersion %T &#x3D;&gt; [%d]\n&quot;, d.TerraformVersion, unsafe.Sizeof(d.TerraformVersion))
    fmt.Printf(&quot;ModuleVersionMajor Field StructType:d.ModuleVersionMajor %T &#x3D;&gt; [%d]\n&quot;, d.ModuleVersionMajor, unsafe.Sizeof(d.ModuleVersionMajor))
&#125;

</code></pre>
<p>outputå¦‚ä¸‹</p>
<pre class="language-golang" data-language="golang"><code class="language-golang">go run golang-struct-memory-allocation-optimized.go

&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Total Memory Usage StructType:d main.TerraformResource &#x3D;&gt; [72]
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Cloud Field StructType:d.Cloud string &#x3D;&gt; [16]
Name Field StructType:d.Name string &#x3D;&gt; [16]
HaveDSL Field StructType:d.HaveDSL bool &#x3D;&gt; [1]
PluginVersion Field StructType:d.PluginVersion string &#x3D;&gt; [16]
ModuleVersionMajor Field StructType:d.IsVersionControlled bool &#x3D;&gt; [1]
TerraformVersion Field StructType:d.TerraformVersion string &#x3D;&gt; [16]
ModuleVersionMajor Field StructType:d.ModuleVersionMajor int32 &#x3D;&gt; [4]
</code></pre>
<p>ç°åœ¨TerraformResourceç±»å‹çš„æ€»å†…å­˜åˆ†é…æ˜¯72å­—èŠ‚ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å†…å­˜çš„æ’åˆ—æ–¹å¼æ˜¯ä»€ä¹ˆæ ·å­çš„</p>
<p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--V9hRLdR1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/kodelint/blog-assets/raw/main/images/03-golang-struct-memory-map.jpeg"></p>
<p>ä»…ä»…é€šè¿‡å¯¹ç»“æ„å…ƒç´ è¿›è¡Œé€‚å½“çš„æ•°æ®ç»“æ„å¯¹é½ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå°†å†…å­˜å ç”¨ä»88å­—èŠ‚å‡å°‘åˆ°72å­—èŠ‚â€¦.ï¼Œå¾ˆå¥½!</p>
<p>è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ•°å­¦è¿ç®—</p>
<blockquote>
<p>åˆ†é…å­—èŠ‚&#x3D;16å­—èŠ‚+16å­—èŠ‚+16å­—èŠ‚+16å­—èŠ‚+4å­—èŠ‚+1å­—èŠ‚+1å­—èŠ‚&#x3D;70å­—èŠ‚<br>ç©ºå«å­—èŠ‚&#x3D;2å­—èŠ‚<br>æ€»å­—èŠ‚æ•°&#x3D;åˆ†é…å­—èŠ‚æ•°+ç©ºå«å­—èŠ‚æ•°&#x3D;70å­—èŠ‚+2å­—èŠ‚&#x3D;72å­—èŠ‚</p>
</blockquote>
<p>é€‚å½“çš„æ•°æ®ç»“æ„æ’åˆ—ä¸ä»…å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜ï¼Œè¿˜å¯ä»¥å¸®åŠ©CPUè¯»å–å‘¨æœŸâ€¦.ï¼Œå¦‚ä½•ï¼Ÿ</p>
<p>CPUä»¥å­—ä¸ºå•ä½è¯»å–å†…å­˜ï¼Œ32ä½ç³»ç»Ÿä¸º4å­—èŠ‚ï¼Œ64ä½ç³»ç»Ÿä¸º8å­—èŠ‚ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç»“æ„ç±»å‹TerraformResourceçš„å£°æ˜å°†éœ€è¦11ä¸ªå­—æ¥è®©CPUè¯»å–æ‰€æœ‰å†…å®¹ã€‚</p>
<p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--YxrCrSAs--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/kodelint/blog-assets/raw/main/images/01-golang-struct-word-length.jpeg"></p>
<p>ç„¶è€Œï¼Œä¼˜åŒ–åçš„ç»“æ„åªéœ€è¦9ä¸ªå­—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--_N8r3Z9U--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://github.com/kodelint/blog-assets/raw/main/images/02-golang-struct-word-length.jpeg"></p>
<p>é€šè¿‡æ­£ç¡®å®šä¹‰ç»“æ„ä½“çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°ä½¿ç”¨å†…å­˜åˆ†é…ï¼Œå¹¶ä½¿ç»“æ„ä½“åœ¨CPUè¯»å–æ–¹é¢ä¹Ÿå˜å¾—å¿«é€Ÿæœ‰æ•ˆã€‚</p>
<p>è¿™åªæ˜¯ä¸€ä¸ªå°ä¾‹å­ï¼Œæƒ³æƒ³ä¸€ä¸ªæœ‰20æˆ–30ä¸ªä¸åŒç±»å‹å­—æ®µçš„å¤§å‹ç»“æ„ã€‚å¯¹æ•°æ®ç»“æ„è¿›è¡Œæ·±æ€ç†Ÿè™‘çš„è°ƒæ•´çœŸçš„å¾ˆæœ‰ä»·å€¼â€¦â€¦ğŸ¤©</p>
<p>å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¤Ÿå¯¹ç»“æ„çš„å†…éƒ¨ç»“æ„ã€å…¶å†…å­˜åˆ†é…å’Œæ‰€éœ€çš„CPUè¯»å–å‘¨æœŸæœ‰ä¸€äº›å¯å‘ã€‚å¸Œæœ›è¿™å¯¹ä½ æœ‰å¸®åŠ©ï¼!</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/26/archive/%E5%86%85%E5%AD%98%E9%AB%98%E6%95%88golang/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/26/archive/remote_github/"
                            aria-label=": æ›´æ–°origin å’Œupstream urlé“¾æ¥"
                        >
                            æ›´æ–°origin å’Œupstream urlé“¾æ¥
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-26T21:14:30+08:00">
	
		    Aug 26, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/archive/">archive</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ¬åœ°æƒ³æ›´æ”¹é¡¹ç›®ä»£ç çš„ç»‘å®šçš„githubé“¾æ¥ï¼Œä½†æ˜¯repoçš„urlå˜äº†ã€‚<br><code>remote: This repository moved. Please use the new location [new location]</code> çš„è­¦ç¤ºã€‚å› ç‚ºä½ çš„gité€£çµä½ç½®æœ‰è®Šå‹•å› æ­¤è¦ä¿®æ”¹æœ¬æ©Ÿç«¯çš„git remoteä½ç½®ã€‚å¦å¤–ä¸€ç§åœºæ™¯ä¸‹è½½åˆ«äººçš„ä»£ç åº“ï¼Œå¹¶åšä¿®æ”¹æœ€åæ¨åˆ°è‡ªå·±çš„githubï¼Œè¿™ä¸ªgithub repo</p>
<h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><ul>
<li>ç»‘å®šæœ¬åœ°originä»“åº“  <pre class="language-bash" data-language="bash"><code class="language-bash">git remote set-url origin https:&#x2F;&#x2F;XXX.git</code></pre></li>
<li>ç»‘å®šupstreamä»“åº“  <pre class="language-bash" data-language="bash"><code class="language-bash">$ git remote add upstream https:&#x2F;&#x2F;github.com&#x2F;ORIGINAL_OWNER&#x2F;ORIGINAL_REPOSITORY.git</code></pre></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/26/archive/remote_github/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/12/MIT6.824/lab2b/lab2_raft_paper/"
                            aria-label=": MIT6.824ä¹‹lab2_raft_paper"
                        >
                            MIT6.824ä¹‹lab2_raft_paper
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-12T21:57:38+08:00">
	
		    Aug 12, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">åˆ†å¸ƒå¼</a>, <a class="category-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/MIT6-824/">MIT6.824</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="ä¸€-å¯ç†è§£çš„ä¸€è‡´æ€§ç®—æ³•ç ”ç©¶-è®ºæ–‡"><a href="#ä¸€-å¯ç†è§£çš„ä¸€è‡´æ€§ç®—æ³•ç ”ç©¶-è®ºæ–‡" class="headerlink" title="ä¸€.å¯ç†è§£çš„ä¸€è‡´æ€§ç®—æ³•ç ”ç©¶-è®ºæ–‡"></a>ä¸€.å¯ç†è§£çš„ä¸€è‡´æ€§ç®—æ³•ç ”ç©¶-è®ºæ–‡</h1><h1 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h1><ul>
<li>raftæ¯”paxosæ›´å®¹æ˜“ç†è§£,åœ¨æ„å»ºå¤§å‹ç³»ç»Ÿçš„æ—¶å€™æ–¹ä¾¿å®ç°</li>
</ul>
<h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1 ä»‹ç»"></a>1 ä»‹ç»</h1><ol>
<li>ä»€ä¹ˆå«ä¸€è‡´æ€§ç®—æ³•ï¼Œä¸€è‡´æ€§ç®—æ³•å°±æ˜¯åè°ƒå¤šå°æœºå™¨æœ‰åºå·¥ä½œï¼Œå…è®¸æˆå‘˜å¤±è´¥</li>
<li>å¤©ä¸‹è‹¦paxosä¹…çŸ£ï¼Œéœ€è¦ä¸ªæ›´ç®€å•ç†è§£å’Œå®ç°çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜ç†è§£ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ç®—æ³•</li>
<li>raftå°†é—®é¢˜åˆ†è§£ï¼Œå‡å°‘raftä¸ç¡®å®šæ€§ï¼Œåœ¨å®é™…çš„æ•™å­¦å½“ä¸­ï¼Œraftè¦æ¯”paxoså®¹æ˜“ç†è§£</li>
<li>raftä¸Okiï¼ŒVSRå¾ˆåƒï¼Œä½†æœ‰å¦‚ä¸‹æ–°ç‰¹æ€§<ul>
<li>å¼ºleader ï¼š æ—¥å¿—åªä»é¢†å¯¼æµå‘follower</li>
<li>leaderé€‰ä¸¾ ï¼š raftä½¿ç”¨éšæœºå®šæ—¶å™¨æ¥é€‰ä¸¾é¢†å¯¼äººã€‚</li>
<li>æˆå‘˜å˜æ›´ ï¼š raftä½¿ç”¨äº†ä¸€ç§æ–°çš„<code>è”åˆå…±è¯†</code>çš„æ–¹æ³•ï¼Œå¤šæ•°ä¸¤ç§ä¸åŒçš„é…ç½®åœ¨è½¬æ¢è¿‡ç¨‹ä¸­é‡å åœ¨ä¸€èµ·</li>
</ul>
</li>
<li>ä½¿åŠ²å¹raftå¤šä¹ˆå¤šä¹ˆç‰›é€¼ï¼Œç®—æ³•æ€§èƒ½ä¸å…¶ä»–ä¸€è‡´æ€§ç®—æ³•å·®ä¸å¤šï¼Œæœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä»‹ç»äº†å¤åˆ¶çš„çŠ¶æ€æœºé—®é¢˜ï¼ˆç¬¬2èŠ‚ï¼‰ï¼Œè®¨è®ºäº†Paxosçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼ˆç¬¬3èŠ‚ï¼‰ï¼Œæè¿°äº†æˆ‘ä»¬å¯¹å¯ç†è§£æ€§çš„ä¸€èˆ¬æ–¹æ³•ï¼ˆç¬¬4èŠ‚ï¼‰ï¼Œæå‡ºäº†Raftå…±è¯†ç®—æ³•ï¼ˆç¬¬5-8èŠ‚ï¼‰ï¼Œè¯„ä¼°äº†Paxosï¼ŒRaftå…±è¯†ç®—æ³•ï¼ˆç¬¬5-8èŠ‚ï¼‰ï¼Œè¯„ä¼°äº†Raftï¼ˆç¬¬9èŠ‚ï¼‰ï¼Œå¹¶è®¨è®ºäº†ç›¸å…³å·¥ä½œï¼ˆç¬¬10èŠ‚ï¼‰ã€‚</li>
</ol>
<h1 id="2-å¤åˆ¶çŠ¶æ€æœº"><a href="#2-å¤åˆ¶çŠ¶æ€æœº" class="headerlink" title="2. å¤åˆ¶çŠ¶æ€æœº"></a>2. å¤åˆ¶çŠ¶æ€æœº</h1><ol>
<li><p>å…±è¯†é€šå¸¸å‡ºç°åœ¨çŠ¶æ€æœºèƒŒæ™¯ä¸‹ï¼Œå†—ä½™çŠ¶æ€æœºé€šå¸¸è¢«ç”¨æ¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å®¹é”™é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œè¯¸å¦‚GFS [8], HDFS [38],å’ŒRAMäº‘[33]é€šå¸¸ä½¿ç”¨ä¸€ä¸ªçŠ¶æ€æœºç®¡ç†leaderé€‰ä¸¾ï¼Œå­˜å‚¨ç›¸å…³é‡è¦çš„é…ç½®ä¿¡æ¯å¤åˆ¶çŠ¶æ€æœºçš„ä¾‹å­åŒ…æ‹¬Chubby[2] å’Œ ZooKeeper [11]</p>
<p> <img src="/./../../../picture/mit6.824/raft_figure_1.png" alt="raft_figure_1"></p>
</li>
<li><p>å› ä¸ºä¸¤å°çŠ¶æ€æœºæŒ‰é¡ºåºæ‰§è¡Œç›¸åŒçš„<code>æ—¥å¿—</code>x&#x3D;1.y&#x3D;3ç­‰ç­‰,é‚£ä¹ˆè¿™ä¸¤ä¸ªçŠ¶æ€æœºè®¡ç®—çš„çŠ¶æ€å’Œè¾“å‡ºçš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å…±è¯†ç®—æ³•è¦ä¿è¯æ—¥å¿—çš„ä¸€è‡´æ€§æ˜¯éå¸¸é‡è¦çš„å·¥ä½œã€‚å³ä½¿ä¸€äº›çŠ¶æ€æœºå› ä¸ºæœºæ¢°æ•…éšœå¯¼è‡´å®•æœº(å°‘äºraftè§„å®šçš„æ•°é‡)ï¼Œä½†æ˜¯è¿™äº›æœåŠ¡å™¨çœ‹èµ·æ¥è¿˜æ˜¯åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<ul>
<li>å®ƒä»¬ç¡®ä¿åœ¨æ‰€æœ‰éæ‹œå åº­æ¡ä»¶ä¸‹çš„å®‰å…¨æ€§ï¼ˆæ°¸è¿œä¸ä¼šè¿”å›é”™è¯¯çš„ç»“æœï¼‰ï¼ŒåŒ…æ‹¬ç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºã€ä»¥åŠæ•°æ®åŒ…ä¸¢å¤±ã€é‡å¤å’Œé‡æ–°æ’åº</li>
<li>åªè¦æœ‰ä»»ä½•ä¸€å°æœåŠ¡å™¨åœ¨è¿è¡Œï¼Œå®ƒä»¬å°±èƒ½å®Œå…¨å‘æŒ¥å¯ç”¨ä½œç”¨ã€‚å¤§éƒ¨åˆ†çš„æœåŠ¡å™¨éƒ½åœ¨è¿è¡Œï¼Œå¹¶èƒ½ä¸å…¶ä»–æœåŠ¡å™¨å’Œå®¢æˆ·è¿›è¡Œé€šä¿¡ã€‚å½¼æ­¤ä¹‹é—´ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œé€šä¿¡å› æ­¤ï¼Œä¸€ä¸ªå…¸å‹çš„ç”±äº”å°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤å¯ä»¥å®¹å¿ä»»ä½•ä¸¤å°æœåŠ¡å™¨çš„æ•…éšœ,å‡è®¾æœåŠ¡å™¨çš„æ•…éšœæ˜¯é€šè¿‡åœæ­¢ï¼›å®ƒä»¬åæ¥å¯èƒ½ä»ç¨³å®šçš„å­˜å‚¨ä¸­æ¢å¤çŠ¶æ€å¹¶é‡æ–°åŠ å…¥é›†ç¾¤ã€‚</li>
<li>å®ƒä»¬å¹¶ä¸ä¾èµ–æ—¶é—´æ¥ç¡®ä¿æ—¥å¿—çš„ä¸€è‡´æ€§ï¼šæ—¶é’Ÿæ•…éšœå’Œæç«¯çš„æ¶ˆæ¯å»¶è¿Ÿåœ¨æœ€åçš„æƒ…å†µä¸‹ä¼šå¯¼è‡´å¯ç”¨æ€§é—®é¢˜ã€‚å»¶è¿Ÿï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´å¯ç”¨æ€§é—®é¢˜ã€‚</li>
<li>åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œåªè¦é›†ç¾¤ä¸­çš„å¤§å¤šæ•°followerå“åº”äº†å‘½ä»¤ï¼Œå‘½ä»¤å°±ä»¥å®Œæˆã€‚ä¸€æ—¦é›†ç¾¤ä¸­çš„å¤§å¤šæ•°followerå¯¹å•è½®RPCä½œå‡ºååº”ï¼Œä¸€ä¸ªå‘½ä»¤å°±å·²ç»å®Œæˆã€‚å°‘æ•°ç¼“æ…¢çš„åŠ¡å™¨ä¸å½±å“æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚</li>
</ul>
<p> æ€»ç»“ : ç¬¬äºŒèŠ‚ä¸»è¦æ˜¯å¼•å…¥çŠ¶æ€æœºçš„å¤ªç²˜ï¼Œå¹¶ç»™å‡ºraftä¸çŠ¶æ€æœºäº¤äº’çš„å¤§è‡´æµç¨‹</p>
</li>
</ol>
<h1 id="3-Paxosæ€ä¹ˆäº†ï¼Ÿ"><a href="#3-Paxosæ€ä¹ˆäº†ï¼Ÿ" class="headerlink" title="3 Paxosæ€ä¹ˆäº†ï¼Ÿ"></a>3 Paxosæ€ä¹ˆäº†ï¼Ÿ</h1><ol>
<li><p>Leslie Lamportåˆ›é€ äº†paxoså…±è¯†ç®—æ³•ï¼Œpaxosè¢«è¯æ˜æ˜¯å®‰å…¨çš„(èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´)ï¼Œæœ‰æ•ˆçš„ã€‚ä½†æ˜¯paxosæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹(ps:ä»€ä¹ˆæ˜¯å¤špaxos,single-decreeå­é›†)</p>
<ul>
<li>paxoséå¸¸éš¾ä»¥ç†è§£ï¼Œä¸“ä¸šäººå£«ä¹Ÿå¾ˆéš¾ç†è§£å…¨é¢ï¼ŒPaxosçš„ä¸é€æ˜æ€§æ¥è‡ªäºå®ƒé€‰æ‹©äº†(å•æ³•ä»¤)å­é›†ä½œä¸ºå…¶åŸºç¡€</li>
<li>æ„å»ºå®é™…ç³»ç»Ÿæ—¶å€™ä¹Ÿå¾ˆéš¾å»å®ç°ï¼Œå¹¶éªŒè¯ï¼Œï¼ŒPaxosä½¿ç”¨çš„æ˜¯å¯¹ç§°çš„å¯¹ç­‰æ–¹æ³•ä¸ºæ ¸å¿ƒï¼ˆå°½ç®¡å®ƒæœ€ç»ˆå»ºè®®é‡‡ç”¨ä¸€ç§å¼±çš„é¢†å¯¼å½¢å¼ä½œä¸ºæ€§èƒ½ä¼˜åŒ–ï¼‰ã€‚è¿™åœ¨ç®€åŒ–é—®é¢˜ä¸Šæ˜¯æœ‰æ„ä¹‰çš„.ä½†å¾ˆå°‘æœ‰å®é™…çš„ç³»ç»Ÿä½¿ç”¨è¿™ç§æ–¹æ³•</li>
</ul>
</li>
<li><p>æ„å»ºä¸€ä¸ªpaxosä¸ºåŸºç¡€çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆéš¾ï¼Œç†è§£paxosç®—æ³•ä¹Ÿå¾ˆéš¾(ps:ä¸‹é¢å¼•ç”¨æ¥è‡ªäºChubbyç³»ç»Ÿçš„æ€»ç»“)ã€‚æ‰€ä»¥ä½œè€…è®¤ä¸ºpaxosæ²¡æœ‰ä¸ºæ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›ä¸€ä¸ªå¾ˆå¥½çš„åŸºç¡€ï¼Œæ‰€ä»¥ä½œè€…æå‡ºäº†æ–°çš„ä¸€è‡´æ€§ç®—æ³• â€“ å®¹æ˜“ç†è§£ï¼Œå¯¹æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¹Ÿæœ‰å¸®åŠ©ã€‚åœ¨è®¾è®¡raftç®—æ³•çš„æ—¶å€™ï¼Œä½œè€…ä½¿ç”¨é—®é¢˜åˆ†è§£æ–¹æ³•ï¼Œå°†é—®é¢˜åˆ†è§£ä¸ºï¼Œé€‰ä¸¾ï¼Œæ—¥å¿—å¤åˆ¶ï¼Œå®‰å…¨å’Œæˆå‘˜å˜æ›´ç­‰ä¸»è¦å­é—®é¢˜ã€‚</p>
<blockquote>
<p>Paxosç®—æ³•çš„æè¿°ä¸ç°å®ä¸–ç•Œçš„éœ€æ±‚ä¹‹é—´å­˜åœ¨ç€å·¨å¤§çš„å·®è·ã€‚æœ€ç»ˆçš„ç³»ç»Ÿå°†åŸºäºä¸€ä¸ªæœªç»è¯å®çš„åè®®[4]ã€‚</p>
</blockquote>
</li>
<li><p>ç¬¬äºŒä¸ªç®€åŒ–çš„åœ°æ–¹æ˜¯ç®€åŒ–äº†çŠ¶æ€ç©ºé—´ï¼Œä½¿ç³»ç»Ÿè¿è´¯ï¼Œä½œè€…åŠªåŠ›æ¶ˆé™¤ä¸ç¡®å®šæ€§ï¼Œæ—¥å¿—ä¸å…è®¸æœ‰æ´ï¼Œå¹¶ä¸”Rafté™åˆ¶äº†æ—¥å¿—å¯èƒ½å˜å¾—å½¼æ­¤ä¸ä¸€è‡´çš„æ–¹å¼ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ç¡®å®šæ€§å®é™…ä¸Šæé«˜äº†å¯ç†è§£æ€§ã€‚ç‰¹åˆ«æ˜¯ï¼ŒéšæœºåŒ–æ–¹æ³•å¼•å…¥äº†ä¸ç¡®å®šæ€§ï¼Œä½†å®ƒä»¬å€¾å‘äºé€šè¿‡å¤„ç†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©æ¥å‡å°‘çŠ¶æ€çš„ç©ºé—´ï¼Œä»¥ä¸€ç§ç±»ä¼¼çš„æ–¹å¼å¤„ç†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹© (â€œé€‰æ‹©ä»€ä¹ˆ,è¿™å¹¶ä¸é‡è¦â€)ã€‚æˆ‘ä»¬ä½¿ç”¨éšæœºåŒ–æ¥ç®€åŒ–Rafté¢†è¢–é€‰ä¸¾ç®—æ³•</p>
</li>
</ol>
<text style="font-family:Courier New;color:red">

<p>æ€»ç»“ : ç¬¬ä¸‰èŠ‚åªæ˜¯é˜è¿°äº†paxosçš„<code>é—®é¢˜</code>,æ¯”å¦‚éš¾ç†è§£ï¼Œå¾ˆéš¾å®ç°åœ¨æ„å»ºå¤§å‹ç³»ç»Ÿçš„ã€‚</p>
</text>

<h1 id="4-è®¾è®¡çš„å¯ç†è§£æ€§"><a href="#4-è®¾è®¡çš„å¯ç†è§£æ€§" class="headerlink" title="4. è®¾è®¡çš„å¯ç†è§£æ€§"></a>4. è®¾è®¡çš„å¯ç†è§£æ€§</h1><ol>
<li>åœ¨è®¾è®¡raftä¹‹åˆå°±è®¾ç½®äº†å¦‚ä¸‹ç›®æ ‡<ul>
<li>æä¾›æ­£ç¡®çš„ç†è®ºåŸºç¡€ï¼Œæ–¹ä¾¿ç†è§£</li>
<li>å‡å°‘å¼€å‘æ—¶é—´ï¼Œå¹¶æ˜“äºæ‰©å±•</li>
<li>åœ¨æ–Ÿé…Œå¤‡é€‰æ–¹æ¡ˆæ—¶ï¼Œä¸»è¦æ˜¯ä»å¯ç†è§£æ€§ï¼Œä¼šä¸ä¼šraft(çŠ¶æ€ç©ºé—´ï¼Œç³»ç»Ÿ)å˜å¾—å¤æ‚ï¼Œä½†æ˜¯è¿™ç§åˆ†ææ˜¯å¾ˆä¸»è§‚çš„(æƒ³æƒ³ä½œè€…ä¸æˆ‘ä»¬çš„ç¡¬å®åŠ›å·®è·)ï¼Œæ‰€ä»¥ä½œè€…é€‰æ‹©äº†ä¸¤ç§ç ”ç©¶æ–¹å¼ã€‚<ul>
<li>é—®é¢˜åˆ†è§£ï¼Œå°†å…±è¯†åˆ†è§£ä¸ºç‹¬ç«‹çš„å­é—®é¢˜ï¼Œåˆ†åˆ«ä¸ºé€‰ä¸¾ï¼Œæ—¥å¿—å¤åˆ¶ï¼Œå®‰å…¨å’Œæˆå‘˜å˜æˆã€‚</li>
<li>å‡å°‘çŠ¶æ€ç©ºé—´(åªæœ‰leader,candidate,follower,ä»¥åŠä¼˜åŒ–æåˆ°çš„prevote&#x2F;vote&#x2F;appendentry),ä¸å…è®¸æ—¥å¿—æœ‰æ¼æ´(index1å’Œ3ä¹‹é—´æ˜¯ç©ºçš„æ—¥å¿—)ï¼Œrafté€šè¿‡å†²çªæ£€æµ‹æ¥çŸ«æ­£ä¸ä¸€è‡´æƒ…å†µã€‚éšæœºåŒ–çš„æ–¹æ³•å¼•å…¥äº†éç¡®å®šæ€§ï¼Œä½†å®ƒä»¬å€¾å‘äºé€šè¿‡å¤„ç†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©æ¥å‡å°‘çŠ¶æ€çš„ç©ºé—´ï¼Œä»¥ä¸€ç§ç±»ä¼¼çš„æ–¹å¼å¤„ç†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹© (â€œé€‰æ‹©ä»€ä¹ˆï¼›è¿™å¹¶ä¸é‡è¦â€)ã€‚æˆ‘ä»¬ä½¿ç”¨éšæœºåŒ– æ¥ç®€åŒ–Rafté¢†è¢–é€‰ä¸¾ç®—æ³•</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="5-raftä¸€è‡´æ€§ç®—æ³•"><a href="#5-raftä¸€è‡´æ€§ç®—æ³•" class="headerlink" title="5. raftä¸€è‡´æ€§ç®—æ³•"></a>5. raftä¸€è‡´æ€§ç®—æ³•</h1><ol>
<li>leaderæ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„æ—¥å¿—æ¡ç›®ï¼Œå°†å…¶å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œå¹¶å‘Šè¯‰æœåŠ¡å™¨ä½•æ—¶å¯ä»¥å°†æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°ä»–ä»¬çš„çŠ¶æ€æœºä¸Šã€‚æœ‰ä¸€ä¸ªé¢†å¯¼è€…å¯ä»¥ç®€åŒ–å¯¹å¤åˆ¶æ—¥å¿—çš„ç®¡ç†ã€‚ä¾‹å¦‚åªå…è®¸æ•°æ®ä»é¢†å¯¼è€…æµå‘å…¶ä»–æœåŠ¡å™¨ã€‚ä¸€ä¸ªé¢†å¯¼è€…å¯èƒ½å¤±è´¥æˆ–ä¸å…¶ä»–æœåŠ¡å™¨æ–­å¼€è¿æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ é€‰ä¸¾ä¸€ä¸ªæ–°çš„é¢†å¯¼è€…</li>
</ol>
<p><img src="/./../../../picture/mit6.824/raft_figure_2.png" alt="raft_figure_2"><br>è€ƒè™‘åˆ°é¢†å¯¼è€…çš„æ–¹æ³•ï¼ŒRaftå°†å…±è¯†é—®é¢˜åˆ†è§£ä¸ºä¸‰ä¸ªç›¸å¯¹ç‹¬ç«‹çš„å­é—®é¢˜ï¼Œè¿™å°†åœ¨åé¢çš„å°èŠ‚ä¸­è®¨è®º.</p>
<ul>
<li>leaderé€‰ä¸¾ : ç°ä»»é¢†å¯¼äººå¤±è´¥,å¿…é¡»é€‰æ‹©æ–°çš„é¢†å¯¼äºº</li>
<li>Log replication : é¢†å¯¼è€…å¿…é¡»æ¥å—æ—¥å¿—æ¡ç›®ä»client,å¹¶åœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¤åˆ¶å®ƒä»¬ã€‚è¿«ä½¿å…¶ä»–æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—ä¸€è‡´ï¼ˆç¬¬5.3èŠ‚ï¼‰ã€‚</li>
<li>Safety : Raftçš„å…³é”®å®‰å…¨å±æ€§æ˜¯å›¾ä¸­çš„çŠ¶æ€æœºå®‰å…¨å±æ€§ã€‚å›¾3ä¸­çš„çŠ¶æ€æœºå®‰å…¨å±æ€§ï¼šå¦‚æœä»»ä½•æœåŠ¡å™¨ åœ¨å…¶çŠ¶æ€æœºä¸Šåº”ç”¨äº†ä¸€ä¸ªç‰¹å®šçš„æ—¥å¿—æ¡ç›®ã€‚ é‚£ä¹ˆå…¶ä»–æœåŠ¡å™¨å°±ä¸èƒ½å¯¹ç›¸åŒçš„æ—¥å¿—ç´¢å¼•åº”ç”¨ä¸åŒå‘½ä»¤ å¯¹ç›¸åŒçš„æ—¥å¿—ç´¢å¼•åº”ç”¨ä¸åŒçš„å‘½ä»¤ã€‚ç¬¬5.4èŠ‚æè¿°äº†å¦‚ä½•Raftå¦‚ä½•ç¡®ä¿è¿™ä¸€ç‰¹æ€§ï¼›è¯¥è§£å†³æ–¹æ¡ˆæ¶‰åŠåˆ°ä¸€ä¸ª ç¬¬5.2èŠ‚ä¸­æè¿°çš„é€‰ä¸¾æœºåˆ¶çš„é¢å¤–é™åˆ¶ã€‚</li>
</ul>
<p><img src="/./../../../picture/mit6.824/raft_figure_3.png" alt="raft_figure_3"></p>
<ul>
<li>Election Safety: ä¸€å±Šä»»æœŸå†…æœ€å¤šå¯ä»¥é€‰å‡ºä¸€ä½é¢†å¯¼äºº</li>
<li>Leader Append-Only : é¢†å¯¼è€…ä»ä¸è¦†ç›–æˆ–åˆ é™¤å…¶æ—¥å¿—ä¸­çš„çš„æ¡ç›®ï¼›å®ƒåªæ·»åŠ æ–°çš„æ¡ç›®</li>
<li>Log Matching : å¦‚æœä¸¤ä¸ªæ—¥å¿—åŒ…å«ä¸€ä¸ªå…·æœ‰ç›¸åŒçš„ç´¢å¼•å’Œæœ¯è¯­ï¼Œé‚£ä¹ˆè¿™ä¸¤ä»½æ—¥å¿—çš„æ‰€æœ‰æ¡ç›®éƒ½æ˜¯ç›¸åŒçš„ã€‚ç›´åˆ°ç»™å®šçš„ç´¢å¼•ä¸ºæ­¢</li>
<li>Leader Completeness : å¦‚æœåœ¨ä¸€ä¸ªç»™å®šçš„termä¸­æäº¤äº†ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œé‚£ä¹ˆè¯¥æ—¥å¿—å°†å‡ºç°åœ¨æ‰€æœ‰æ›´é«˜ç¼–å·çš„æœ¯è¯­çš„é¢†å¯¼äººçš„æ—¥å¿—ä¸­ã€‚</li>
<li>State Machine Safety : å¦‚æœä¸€ä¸ªæœåŠ¡å™¨åœ¨å®ƒçš„çŠ¶æ€æœºä¸Šåº”ç”¨äº†ä¸€ä¸ªæ—¥å¿—æ¡ç›® åœ¨å®ƒçš„çŠ¶æ€æœºä¸­åº”ç”¨äº†ä¸€ä¸ªç»™å®šçš„ç´¢å¼•ï¼Œé‚£ä¹ˆå…¶ä»–æœåŠ¡å™¨å°†æ°¸è¿œä¸ä¼šåœ¨åŒä¸€ç´¢å¼•åº”ç”¨ä¸åŒçš„æ—¥å¿—æ¡ç›®.</li>
<li>Raftä¿è¯è¿™äº›å±æ€§ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯çœŸçš„,åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯çœŸå®çš„ã€‚èŠ‚å·è¡¨ç¤ºæ¯ä¸ªå±æ€§çš„è®¨è®ºä½ç½®ã€‚</li>
</ul>
<p><img src="/./../../../picture/mit6.824/raft_figure_4_5.png" alt="raft_figure_3"></p>
<p>æ€»ç»“</p>
<ol>
<li>æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æŒä¹…åŒ–çš„å‚æ•°<ul>
<li><code>currentTerm</code>æŒä¹…åŒ–å‚æ•°ï¼Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–ä¸º0ç„¶åå•è°ƒé€’å¢</li>
<li><code>voteFor</code>å½“å‰termè®°å½•æŠ•ç¥¨çš„candidateId</li>
<li><code>commitIndex</code>è®°å½•å½“å‰èŠ‚ç‚¹å¯ä»¥æäº¤çš„æ—¥å¿—index</li>
<li><code>lastApplied</code>è®°å½•å½“å‰èŠ‚ç‚¹å¯ä»¥æäº¤ç»™ä¸Šå±‚çŠ¶æ€æœºçš„index</li>
<li><code>nextIndex[]</code>å½“leaderè¢«é€‰å‡ºæ—¶éœ€è¦åˆå§‹åŒ–çš„å‚æ•°ï¼Œä¸”æ˜¯leaderæœ€æ–°log+1çš„ä½ç½®</li>
<li><code>matchIndex[]</code>åˆå§‹åŒ–ä¸º0ï¼Œè¡¨ç¤ºleaderä¸followeråŒ¹é…çš„æ—¥å¿—ä½ç½®</li>
</ul>
</li>
<li>reqeustVote RPCç»†èŠ‚<ol>
<li>requestVoteçš„è¯·æ±‚å‚æ•°<ul>
<li><code>term</code>è¯·æ±‚çš„term</li>
<li><code>candidateId</code></li>
<li><code>lastLogIndex</code>candidateæœ€æ–°çš„log</li>
<li><code>lastLogTerm</code>candidateæœ€æ–°çš„term</li>
</ul>
</li>
<li>reqeustVote responseå‚æ•°<ul>
<li><code>term</code>æŠ•ç¥¨æ—¶å€™çš„term</li>
<li><code>voteGranted</code>å¸ƒå°”ç±»å‹ï¼Œtrueè¯´æ˜followeråŒæ„æŠ•ç¥¨</li>
</ul>
</li>
<li>é‡è¦äº¤äº’é€»è¾‘<ul>
<li>å¦‚æœrpcçš„termå°äºfollowerçš„current termï¼Œfolloweræ‹’ç»æŠ•ç¥¨</li>
<li>å¦‚æœvoteForæ˜¯ç©ºæˆ–è€…ä¸ºcandaditeID,å¹¶ä¸”candaidateçš„logè‡³å°‘ä¸followeræ˜¯ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥æ¯”Followerå¤šï¼Œæ–°</li>
</ul>
</li>
</ol>
</li>
<li>AppendEntry RPCç»†èŠ‚<ol>
<li>AppendEntryè¯·æ±‚å‚æ•°<ul>
<li><code>term</code>post RPCæ—¶çš„term</li>
<li><code>leaderID</code></li>
<li><code>preLogIndex</code>leaderè¿›è¡Œä¸€è‡´æ€§æ£€æµ‹æ—¥å¿—çš„index</li>
<li><code>preLogTerm</code>leaderè¿›è¡Œä¸€è‡´æ€§æ£€æµ‹æ—¶æ—¥å¿—çš„term</li>
<li><code>entries</code>æ¬è¿çš„æ—¥å¿—</li>
<li><code>leaderCommit</code>leaderçš„commitIndex</li>
</ul>
</li>
<li>AppendEntryçš„responseå‚æ•°<ul>
<li><code>term</code>RPCçš„å½“å‰term</li>
<li><code>success</code>å¸ƒå°”ç±»å‹è¿”å›trueè¯´æ˜preLogIndexå’ŒpreLogTermæ˜¯åŒ¹é…çš„</li>
</ul>
</li>
<li>AppendEntry RPCçš„å®ç°<ul>
<li>rpcâ€™s termå°äºfollowerâ€™sçš„termåˆ™è¿”å›false</li>
<li>å¦‚æœpreLogIndexï¼ŒpreLogTermä¸åŒ¹é…è¿”å›false</li>
<li>preLogIndexåŒ¹é…ä½†æ˜¯preLogTermä¸åŒ¹é…åˆ™åˆ æ‰åé¢æ‰€æœ‰çš„å­˜åœ¨çš„log</li>
<li>appendæ–°log</li>
<li>leaderCommitå¤§äºfollowerçš„commitIndexæ—¶å€™è¦æŠŠfollowerçš„commitIndexè®¾ç½®ä¸ºmin(leaderCommit,len(logs))</li>
</ul>
</li>
</ol>
</li>
<li>æäº¤ç»™çŠ¶æ€æœºçš„è§„åˆ™<ol>
<li>å¦‚æœfollowerèŠ‚ç‚¹çš„commitIndexå¤§äºlastApplied é‚£ä¹ˆå°±å¯ä»¥å°†logæäº¤ç»™çŠ¶æ€æœº</li>
<li>å¦‚æœå‘ç°æœ‰å¤§çš„term,é‚£ä¹ˆä¸€å®šè¦æ›´æ–°RPCä¸­termå‚æ•°,RPC term  &gt; currentTerm,ç„¶åcandidateæˆ–è€…leaderè½¬å˜ä¸ºfollower</li>
<li>Followeræ”¶ä¸åˆ°å¿ƒè·³å°±è¿›è¡Œé€‰ä¸¾</li>
<li>Followerè´Ÿè´£å“åº”candidateå’Œleader,è¨€å¤–ä¹‹æ„å°±æ˜¯å¤„ç†requestVote RPCå’ŒAppendEntry RPC</li>
<li>Candaditeä¼šå¢åŠ è‡ªå·±çš„term,ç»™è‡ªå·±æŠ•ç¥¨ï¼Œé‡ç½®é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œå‘é€requestVote RPC,å¾—åˆ°å¤šæ•°æŠ•ç¥¨å°±å˜æˆleader</li>
<li>Candidateæ”¶åˆ°å…¶ä»–çš„AppendEntryçš„RPCå°±å˜æˆfollower</li>
<li>Candidateåœ¨é€‰ä¸¾è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å®Œæˆé€‰ä¸¾å°±é‡æ–°å†æ¥ä¸€è½®</li>
<li>Leaderåœ¨ä½æ—¶ä¼šä¸é—´æ–­çš„å‘é€å¿ƒè·³æŠ‘åˆ¶Followeré€‰ä¸¾</li>
<li>Leaderæ¥æ”¶æ¥è‡ªclientçš„å‘½ä»¤ï¼Œç„¶åèµ°å…±è¯†å±‚è¿›è¡Œ</li>
<li>Leaderçš„logIndexå¤§äºnextIndexå°±å¼€å§‹è¿›è¡Œå‘é€AppendEntryçš„RPC,å¦‚æœåŒ¹é…æˆåŠŸå°±æ›´æ–°Leaderçš„matchIndexå’ŒnextIndex,å¦‚æœæ²¡æˆåŠŸå°±å¢åŠ nextIndexç„¶åé‡è¯•</li>
<li>å¦‚æœå­˜åœ¨ä¸€ä¸ªæ•´æ•°N&gt;commitIndex,ç„¶åå¤§éƒ¨åˆ†matchIndex[i]&gt;&#x3D;Nï¼Œé‚£ä¹ˆlog[N]&#x3D;&#x3D;currentTermï¼Œç„¶åå°†Leaderè®¾ç½®commitIndex&#x3D;N</li>
</ol>
</li>
</ol>
<h2 id="5-1-raftåŸºç¡€"><a href="#5-1-raftåŸºç¡€" class="headerlink" title="5.1 raftåŸºç¡€"></a>5.1 raftåŸºç¡€</h2><ol>
<li>äº”å°æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ€å°é›†ç¾¤ï¼Œå®ƒæœ€å¤šå…è®¸ä¸¤å°æœåŠ¡å™¨å®•æœºï¼Œå¹¶ä¸”æ¯å°æœåŠ¡å™¨æœ‰ä¸‰ç§çŠ¶æ€åˆ†åˆ«æ˜¯<code>leader</code>,<code>candidate</code>,<code>follower</code>,followeræ˜¯è¢«åŠ¨çš„ä¸å‘é€ä»»ä½•çš„è¯·æ±‚(RPC),åªæ˜¯ç®€å•çš„å›leaderå’Œcandidateçš„è¯·æ±‚ï¼Œå¦‚æœfolloweræ¥æ”¶åˆ°æ¥è‡ªclientçš„è¯·æ±‚ï¼Œä¹Ÿè¦è·¯ç”±ç»™leaderã€‚Figure 4æè¿°äº†ä¸‰ç§çŠ¶æ€çš„è½¬æ¢å…³ç³»å’Œæ¡ä»¶</li>
<li>raftä¸»è¦å°†æ—¶é—´å®šä¹‰ä¸ºä»»æ„é•¿åº¦çš„term,æ˜¯è¿ç»­ä¸”å•è°ƒé€’å¢çš„,åœ¨æŸäº›æƒ…å†µä¸‹,ä¼šå‡ºç°å¤šä¸ªcandidateåŒæ—¶ç«é€‰leaderçš„æƒ…å†µï¼Œè¿™æ—¶å€™æˆ–ä¼šå‡ºç°<code>ç“œåˆ†æŠ•ç¥¨</code>çš„æƒ…å†µï¼Œè¿™æ˜¯æ•´ä¸ªraftç³»ç»Ÿå°±æ— æ³•ç»§ç»­å‰è¿›é€šè¿‡å¼•å…¥éšæœºé€‰ä¸¾è¶…æ—¶è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªfolloweræ²¡æœ‰åœ¨é€‰ä¸¾è¶…æ—¶å®è·µä¹‹å†…æ¥æ”¶åˆ°leaderçš„heartbeatå°±ä¼šå¼€å§‹é€‰ä¸¾</li>
<li>ä¸åŒçš„æœåŠ¡å™¨å¯èƒ½åœ¨ä¸åŒçš„æ—¶é—´è§‚å¯Ÿåˆ°termä¹‹é—´çš„è½¬æ¢ã€‚è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœåŠ¡å™¨<br>å¯èƒ½è§‚å¯Ÿä¸åˆ°ä¸€æ¬¡é€‰ä¸¾ï¼Œç”šè‡³æ˜¯æ•´ä¸ªä»»æœŸ(candidateåœ¨ä¸€ä¸ªtermæ—¶é—´å†…æ— æ³•å®Œæˆé€‰ä¸¾)ï¼Œtermåœ¨Raftä¸­å……å½“é€»è¾‘æ—¶é’Ÿ[14]ï¼Œå®ƒä»¬å…è®¸æœåŠ¡å™¨æ£€æµ‹è¿‡æ—¶çš„ä¿¡æ¯ï¼Œå¦‚è¿‡æ—¶çš„leaderã€‚æ¯ä¸ªæœåŠ¡å™¨å­˜å‚¨ä¸€ä¸ªå½“å‰çš„currentTermï¼Œè¯¥currentTerméšç€æ—¶é—´çš„æ¨ç§»å•è°ƒåœ°éšæ—¶é—´å¢åŠ ã€‚æ¯å½“æœåŠ¡å™¨è¿›è¡Œé€šä¿¡æ—¶ï¼Œå°±ä¼šäº¤æ¢currentTermã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„currentTermå°äºå¦ä¸€ä¸ªæœåŠ¡å™¨çš„currentTermï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ›´æ–°è‡ªå·±çš„currentTermï¼Œé‚£ä¹ˆå®ƒå°±å°†å…¶currentTermæ›´æ–°ä¸ºè¾ƒå¤§çš„å€¼ã€‚å¦‚æœä¸€ä¸ªcandidateæˆ–leaderå‘ç°å®ƒçš„currenTermå·²ç»è¿‡æ—¶ï¼Œå®ƒå°±ä¼šå˜æˆfollowerã€‚å¦‚æœfolloweræ”¶åˆ°ä¸€ä¸ªè¿‡æ—¶çš„termçš„è¯·æ±‚ï¼Œå®ƒå°†æ‹’ç»è¯¥è¯·æ±‚ã€‚<br><img src="/./../../../picture/mit6.824/raft_figure_6.png" alt="feature 6"></li>
</ol>
<h2 id="5-2-Leader-election"><a href="#5-2-Leader-election" class="headerlink" title="5.2  Leader election"></a>5.2  Leader election</h2><ol>
<li><p>Raftä½¿ç”¨å¿ƒè·³æœºåˆ¶æ¥è§¦å‘é¢†å¯¼è€…é€‰ä¸¾ã€‚å½“æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒä»¬å¼€å§‹ä½œä¸ºè·Ÿéšè€…ã€‚A æœåŠ¡å™¨åªè¦æ”¶åˆ°æœ‰æ•ˆçš„RPCä»leaderæˆ–è€…å€™é€‰äºº,é¢†å¯¼è€…å®šæœŸå‘é€ å¿ƒè·³ï¼ˆAppendEntries RPCsï¼Œä¸æºå¸¦ä»»ä½•æ—¥å¿—æ¡ç›®ï¼‰ã€‚åˆ°æ‰€æœ‰è¿½éšè€…ï¼Œä»¥ç»´æŒä»–ä»¬çš„æƒå¨ã€‚ å¦‚æœä¸€ä¸ª è·Ÿéšè€…åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°é€šä¿¡ï¼Œç§°ä¸ºé€‰ä¸¾è¶…æ—¶ã€‚ç§°ä¸ºé€‰ä¸¾è¶…æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±è®¤ä¸ºæ²¡æœ‰å¯è¡Œçš„é¢†å¯¼è€…ï¼Œå¹¶å¼€å§‹é€‰ä¸¾ï¼Œæƒ³æˆä¸ºä¸€ä¸ªæ–°çš„é¢†å¯¼è€…ã€‚</p>
</li>
<li><p>åœ¨å¼€å§‹é€‰ä¸¾ï¼Œcandidateé€’å¢å…¶å½“å‰termå¹¶è¿‡æ¸¡åˆ°å€™é€‰çŠ¶æ€ã€‚ç„¶å,å®ƒä¸ºè‡ªå·±æŠ•ç¥¨ å¹¶å‘é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡å™¨å‘å‡ºRequestVote RPCsã€‚candidateç»§ç»­å¤„äº è¿™ä¸ªçŠ¶æ€ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€: (a) å®ƒèµ¢å¾—é€‰ä¸¾. (b) å¦ä¸€ä¸ªæœåŠ¡å™¨ç¡®ç«‹äº†è‡ªå·±çš„é¢†å¯¼åœ°ä½ï¼Œæˆ–è€… (c) ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰èµ¢å®¶ã€‚è¿™äº›ç»“æœå°†åœ¨ä¸‹é¢çš„æ®µè½ä¸­åˆ†åˆ«è®¨è®º</p>
</li>
<li><p>å¦‚æœä¸€ä¸ªå€™é€‰äººåœ¨é€‰ä¸¾ä¸­è·å¾—äº†æ¥è‡ªæ•´ä¸ªé›†ç¾¤ä¸­å¤§å¤šæ•°æœåŠ¡å™¨çš„æŠ•ç¥¨ï¼Œé‚£ä¹ˆå®ƒå°±èµ¢å¾—äº†çš„å¤§å¤šæ•°æœåŠ¡å™¨çš„æŠ•ç¥¨é€‰ä¸¾ã€‚æ¯å°æœåŠ¡å™¨åœ¨ç»™å®šçš„ä»»æœŸå†…æœ€å¤šåªèƒ½ä¸ºä¸€åå€™é€‰äººæŠ•ç¥¨ã€‚ä»¥å…ˆæ¥ååˆ°ä¸ºåŸåˆ™ï¼ˆæ³¨æ„:ç¬¬<a href="#54-%E5%AE%89%E5%85%A8%E6%80%A7">5.4å®‰å…¨æ€§</a> èŠ‚å¯¹æŠ•ç¥¨å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„é™åˆ¶ï¼‰ã€‚å¤šæ•°è§„åˆ™ç¡®ä¿æœ€å¤šåªæœ‰ä¸€åcandidateèƒ½åœ¨æŸå±Šé€‰ä¸¾ä¸­è·èƒœï¼ˆé€‰ä¸¾ï¼‰ã€‚ä¸€æ—¦ä¸€ä¸ªcandidateåœ¨é€‰ä¸¾ä¸­è·èƒœï¼Œä»–å°±æˆä¸ºleaderã€‚ç„¶åå®ƒå°†å¿ƒè·³ä¿¡æ¯å‘é€ç»™æ‰€æœ‰çš„å…¶ä»–æœåŠ¡å™¨ï¼Œä»¥å»ºç«‹å…¶æƒå¨å¹¶é˜²æ­¢æ–°çš„é€‰ä¸¾ã€‚</p>
</li>
<li><p>åœ¨ç­‰å¾…æŠ•ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œå€™é€‰äººå¯èƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªå¦ä¸€ä¸ªleaderçš„AppendEntries RPCï¼Œè¯¥RPCæ¥è‡ªå¦ä¸€æœåŠ¡å™¨ï¼Œå£°ç§°è‡ªå·±æ˜¯leaderã€‚å¦‚æœleaderçš„ä»»æœŸ(åŒ…æ‹¬åœ¨å…¶RPCä¸­)è‡³å°‘æ˜¯ä¸Candidateçš„å½“å‰ä»»æœŸä¸€æ ·å¤§,é‚£ä¹ˆcandidateæ‰¿è®¤è¯¥leaderæ˜¯åˆæ³•çš„ï¼Œå¹¶è¿”å›åˆ°FollowerçŠ¶æ€ã€‚å¦‚æœRPCä¸­çš„termå°äºcandidateçš„term,é‚£ä¹ˆCandidateå°±æ‹’ç»RPC(è¢«æ‹’ç»çš„RPCå˜æˆfollower)ï¼Œç»§ç»­å¤„äºå€™é€‰çŠ¶æ€ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰ä¸ªå¯èƒ½çš„ç»“æœæ˜¯ï¼Œä¸€ä¸ªcandidateæ—¢æ²¡æœ‰èµ¢å¾—é€‰ä¸¾ï¼Œä¹Ÿæ²¡æœ‰å¤±å»é€‰ä¸¾ï¼šå¦‚æœè®¸å¤šFolloweråŒæ—¶æˆä¸ºå€™é€‰äººï¼Œé€‰ç¥¨å¯èƒ½è¢«åˆ†å‰²ï¼Œå› æ­¤æ²¡æœ‰å€™é€‰äººè·å¾—å¤šæ•°ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæ¯ä¸ªcandidateéƒ½ä¼šè¶…æ—¶ï¼Œå¹¶é€šè¿‡å¢åŠ å…¶ä»»æœŸå’Œå¯åŠ¨æ–°ä¸€è½®çš„RequestVote RPCæ¥å¼€å§‹æ–°çš„é€‰ä¸¾ã€‚ç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰é¢å¤–çš„æªæ–½ï¼Œåˆ†è£‚çš„æŠ•ç¥¨ å¯ä»¥æ— é™æœŸåœ°é‡å¤.(ä½¿ç”¨éšå³è¶…æ—¶æ—¶é—´æ¥è§£å†³followeråŒæ—¶å˜æˆcandidate,ä¹Ÿé˜²æ­¢äº†candidateåŒæ—¶è¯·æ±‚æŠ•ç¥¨æŠ•ç¥¨çª˜å¢ƒ)</p>
</li>
<li><p>Raftä½¿ç”¨éšæœºçš„é€‰ä¸¾è¶…æ—¶æ¥ç¡®ä¿åˆ†æ­§ç¥¨çš„æƒ…å†µå¾ˆå°‘å‡ºç°ï¼Œè€Œä¸”èƒ½è¿…é€Ÿè§£å†³ã€‚ä¸ºäº†ä»ä¸€å¼€å§‹å°±é˜²æ­¢åˆ†è£‚æŠ•ç¥¨ï¼Œä»ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”ä¸­éšæœºé€‰æ‹©é€‰ä¸¾è¶…æ—¶ï¼ˆä¾‹å¦‚ï¼Œ150-300msï¼‰ã€‚å› æ­¤åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,åœ¨åˆ†æ•£æœåŠ¡å™¨ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ä¼šè¶…æ—¶ã€‚å®ƒèµ¢å¾—äº†é€‰ä¸¾ï¼Œå¹¶åœ¨å…¶ä»–æœåŠ¡å™¨è¶…æ—¶ä¹‹å‰å‘é€äº†åœ¨å…¶ä»–æœåŠ¡å™¨è¶…æ—¶å‰å‘é€å¿ƒè·³ã€‚åŒæ ·çš„æœºåˆ¶è¢«ç”¨æ¥å¤„ç†<code>åˆ†è£‚çš„æŠ•ç¥¨</code>ã€‚æ¯ä¸ªcandidateåœ¨é€‰ä¸¾å¼€å§‹æ—¶é‡æ–°å¯åŠ¨å…¶éšæœºçš„<code>é€‰ä¸¾è¶…æ—¶</code>ã€‚å¹¶ç­‰å¾…è¯¥è¶…æ—¶è¿‡åå†å¼€å§‹ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚è¿™å‡å°‘äº†åœ¨æ–°çš„é€‰ä¸¾ä¸­å‡ºç°æ–°çš„é€‰ä¸¾å†æ¬¡å‡ºç°åˆ†è£‚ç¥¨çš„å¯èƒ½æ€§ã€‚ç¬¬9.3èŠ‚æ˜¾ç¤ºè¿™ç§æ–¹æ³•å¯ä»¥è¿…é€Ÿé€‰å‡ºä¸€ä¸ªé¢†å¯¼è€…</p>
</li>
<li><p>é€‰ä¸¾æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å¯ç†è§£æ€§å¦‚ä½•æŒ‡å¯¼æˆ‘ä»¬å¯¹è®¾è®¡æ–¹æ¡ˆçš„é€‰æ‹©ã€‚æœ€åˆæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨ä¸€ä¸ªæ’åç³»ç»Ÿ:æ¯ä¸ªcandidateè¢«åˆ†é…ä¸€ä¸ªç‹¬ç‰¹çš„æ’åï¼Œç”¨æ¥åœ¨ç«äº‰çš„candidateä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚å¦‚æœä¸€ä¸ªcandidateå‘ç°äº†å¦ä¸€ä¸ªæ’åæ›´é«˜çš„candidateï¼Œå®ƒå°±ä¼šå›åˆ°followerçš„çŠ¶æ€ï¼Œè¿™æ ·æ’åæ›´é«˜çš„å€™é€‰äººå°±èƒ½æ›´å®¹æ˜“åœ°èµ¢å¾—ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚æˆ‘ä»¬å‘ç°ï¼Œè¿™ç§æ–¹æ³•åœ¨å¯ç”¨æ€§æ–¹é¢äº§ç”Ÿäº†ä¸€äº›å¾®å¦™çš„é—®é¢˜(ä¸€ä¸ªæ’åè¾ƒä½çš„æœåŠ¡å™¨å¯èƒ½éœ€è¦è¶…æ—¶ï¼Œå¹¶æˆä¸ºä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ï¼‰ã€‚å¦‚æœä¸€ä¸ªæ’åè¾ƒé«˜çš„æœåŠ¡å™¨å¤±è´¥äº†ï¼Œä¸€ä¸ªæ’åè¾ƒä½çš„æœåŠ¡å™¨å¯èƒ½éœ€è¦è¶…æ—¶å¹¶å†æ¬¡æˆä¸ºå€™é€‰äººï¼Œä½†å¦‚æœå®ƒè¿‡æ—©åœ°è¿™æ ·åšï¼Œå®ƒå¯èƒ½ä¼šé‡ç½®é€‰ä¸¾é¢†å¯¼è€…çš„è¿›å±•)ã€‚æˆ‘ä»¬å¯¹ç®—æ³•è¿›è¡Œäº†å¤šæ¬¡è°ƒæ•´ï¼Œä½†æ¯æ¬¡è°ƒæ•´åéƒ½ä¼šå‡ºç°æ–°çš„corner casesã€‚æœ€ç»ˆæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œéšæœºé‡è¯•çš„æ–¹æ³•æ›´åŠ æ˜æ˜¾å’Œå®¹æ˜“ç†è§£ã€‚</p>
</li>
</ol>
<h2 id="5-3-Log-replication"><a href="#5-3-Log-replication" class="headerlink" title="5.3 Log replication"></a>5.3 Log replication</h2><ol>
<li><p>ä¸€æ—¦ä¸€ä¸ªé¢†å¯¼è€…è¢«é€‰å‡ºï¼Œå®ƒå°±å¼€å§‹ä¸ºå®¢æˆ·ç«¯è¯·æ±‚ã€‚æ¯ä¸ªå®¢æˆ·è¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªå‘½ä»¤ï¼Œç”±å¤åˆ¶çš„çŠ¶æ€æœºæ‰§è¡Œã€‚leaderå°†è¯¥å‘½ä»¤ä½œä¸ºä¸€ä¸ªæ–°æ¡ç›®é™„åŠ åˆ°å®ƒçš„æ—¥å¿—ä¸­ï¼Œç„¶åå‘å…¶ä»–æ¯ä¸ªæœåŠ¡å™¨å¹¶è¡Œåœ°å‘å‡ºAppendEntries RPCsæ¥å¤åˆ¶è¯¥æ¡ç›®ã€‚å½“è¯¥æ¡ç›®å·²ç»è¢«å®‰å…¨å¤åˆ¶åï¼ˆå¦‚ä¸‹æ‰€è¿°ï¼‰ï¼Œleaderå°†è¯¥æ¡ç›®åº”ç”¨äºå…¶çŠ¶æ€æœºå¹¶è¿”å›ï¼Œå¹¶å°†æ‰§è¡Œçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœè·Ÿéšè€…å´©æºƒæˆ–è¿è¡Œç¼“æ…¢ã€‚æˆ–è€…ç½‘ç»œæ•°æ®åŒ…ä¸¢å¤±ï¼Œé¢†å¯¼è€…ä¼šæ— é™æœŸåœ°é‡è¯•AppendEntries RPCsç”šè‡³åœ¨å®ƒå·²ç»å“åº”äº†ç›´åˆ°æ‰€æœ‰è·Ÿéšè€…æœ€ç»ˆå­˜å‚¨äº†æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®ã€‚</p>
</li>
<li><p>æ—¥å¿—çš„ç»„ç»‡æ–¹å¼å¦‚å›¾figure 6æ‰€ç¤ºã€‚æ¯ä¸ªæ—¥å¿—æ¡ç›®éƒ½å­˜å‚¨äº†ä¸€æ¡çŠ¶æ€æœºå‘½ä»¤ï¼Œä»¥åŠé¢†å¯¼è€…æ”¶åˆ°è¯¥æ¡ç›®æ—¶çš„termç¼–å·ã€‚æ—¥å¿—æ¡ç›®ä¸­çš„termè¢«ç”¨æ¥æ£€æµ‹æ—¥å¿—ä¹‹é—´çš„ä¸ä¸€è‡´ï¼Œå¹¶ç¡®ä¿å›¾figure 3ä¸­çš„ä¸€äº›å±æ€§ã€‚æ¯ä¸ªæ—¥å¿—æ¡ç›®ä¹Ÿæœ‰ä¸€ä¸ªæ•´æ•°ç´¢å¼•ï¼Œç”¨æ¥è¯†åˆ«å®ƒåœ¨æ—¥å¿—ä¸­çš„ä½ç½®</p>
</li>
<li><p>leaderå†³å®šä½•æ—¶å°†æ—¥å¿—æ¡ç›®åº”ç”¨äºçŠ¶æ€æœºæ˜¯å®‰å…¨çš„ï¼›è¿™æ ·çš„æ¡ç›®è¢«ç§°ä¸º<code>commited</code>ã€‚Raftä¿è¯æ‰€æäº¤çš„logEntryæ˜¯æŒä¹…çš„å¹¶ä¸”æœ€ç»ˆä¼šè¢«æ‰€æœ‰å¯ç”¨çš„çŠ¶æ€æœºæ‰§è¡Œã€‚ä¸€æ—¦åˆ›å»ºæ—¥å¿—æ¡ç›®çš„leaderåˆ›å»ºè¯¥æ¡ç›®çš„é¢†å¯¼è€…å°†å…¶å¤åˆ¶åˆ°å¤§å¤šæ•°çš„æœåŠ¡å™¨ä¸Š(ä¾‹å¦‚ï¼Œå›¾6ä¸­çš„ç¬¬7æ¡)ï¼ŒåŒ…æ‹¬ä¹‹å‰leaderåˆ›å»ºçš„logEntryåŒ…æ‹¬ç”±ä»¥å‰çš„é¢†å¯¼è€…åˆ›å»ºçš„æ¡ç›®ã€‚ç¬¬<a href="#54-%E5%AE%89%E5%85%A8%E6%80%A7">5.4èŠ‚</a>å®ƒè¿˜è¡¨æ˜ï¼Œè¿™ç§<code>commited</code>çš„å®šä¹‰æ˜¯å®‰å…¨ã€‚é¢†å¯¼è€…è·Ÿè¸ªå®ƒæ‰€çŸ¥é“çš„æœ€é«˜<code>commited</code>çš„æœ€é«˜ç´¢å¼•ï¼Œå¹¶å°†è¯¥ç´¢å¼•åŒ…æ‹¬åœ¨æœªæ¥çš„ AppendEntries RPCsï¼ˆåŒ…æ‹¬å¿ƒè·³ï¼‰ä¸­ï¼Œä»¥ä¾¿å…¶ä»–æœåŠ¡å™¨æœ€ç»ˆå‘ç°ã€‚å…¶ä»–æœåŠ¡å™¨æœ€ç»ˆä¼šå‘ç°ã€‚ä¸€æ—¦ä¸€ä¸ªè·Ÿéšè€…çŸ¥é“ ä¸€æ—¦è·Ÿéšè€…å¾—çŸ¥ä¸€ä¸ªæ—¥å¿—æ¡ç›®è¢«æäº¤ï¼Œå®ƒå°±ä¼šå°†è¯¥æ¡ç›®åº”ç”¨åˆ°å…¶æœ¬åœ°çŠ¶æ€æœºï¼ˆæŒ‰æ—¥å¿—é¡ºåº).</p>
</li>
<li><p>æˆ‘ä»¬è®¾è®¡çš„Raftæ—¥å¿—æœºåˆ¶åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„æ—¥å¿—ä¹‹é—´ä¿æŒé«˜åº¦çš„ä¸€è‡´æ€§ã€‚è¿™ä¸ä»…ç®€åŒ–äº†ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä½¿å…¶æ›´å…·å¯é¢„æµ‹æ€§ï¼Œè€Œä¸”æ˜¯ç¡®ä¿å®‰å…¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚Raftç»´æŠ¤ä»¥ä¸‹å±æ€§ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†æ—¥å¿—åŒ¹é…å±æ€§åœ¨figure 3ä¸­.</p>
</li>
</ol>
<ul>
<li>å¦‚æœä¸åŒæœåŠ¡å™¨æ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®å…·æœ‰ç›¸åŒçš„ç´¢å¼•å’Œtermï¼Œé‚£ä¹ˆå®ƒä»¬å­˜å‚¨çš„æ˜¯åŒä¸€ä¸ªå‘½ä»¤ã€‚</li>
<li>å¦‚æœä¸åŒæœåŠ¡å™¨æ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®å…·æœ‰ç›¸åŒçš„ç´¢å¼•å’Œtermï¼Œé‚£ä¹ˆè¿™äº›æ—¥å¿—åœ¨æ‰€æœ‰å‰é¢çš„æ¡ç›®ç›¸åŒã€‚</li>
</ul>
<ol>
<li><p>ç¬¬ä¸€ä¸ªå±æ€§ï¼šä¸€ä¸ªleaderåœ¨ä¸€ä¸ªç»™å®šçš„termä¸­æœ€å¤šåˆ›å»ºä¸€ä¸ªå…·æœ‰ç»™å®šæ—¥å¿—ç´¢å¼•çš„logEntryï¼Œè€ŒlogEntryæ°¸è¿œä¸ä¼šæ”¹å˜å®ƒä»¬åœ¨æ—¥å¿—ä¸­çš„ä½ç½®ã€‚ç¬¬äºŒä¸ªå±æ€§ç”±AppendEntriesæ‰§è¡Œçš„ç®€å•ä¸€è‡´æ€§æ£€æŸ¥æ¥ä¿è¯ã€‚å½“å‘é€ä¸€ä¸ªAppendEntries RPCæ—¶ï¼Œleaderåœ¨å…¶æ—¥å¿—ä¸­åŒ…æ‹¬æ¡ç›®çš„ç´¢å¼•ä»¥åŠç´§æ¥åœ¨å…¶æ—¥å¿—ä¸­çš„æ¡ç›®çš„ç´¢å¼•å’Œtermã€‚å¦‚æœfolloweråœ¨å…¶æ—¥å¿—ä¸­æ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç›¸åŒç´¢å¼•å’Œæœ¯è¯­çš„æ¡ç›®å®ƒçš„æ—¥å¿—ä¸­æ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç›¸åŒç´¢å¼•å’Œtermçš„æ¡ç›®ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ‹’ç»è¿™äº›logEntryã€‚ä¸€è‡´æ€§æ£€æŸ¥å……å½“äº†ä¸€ä¸ªå½’çº³æ­¥éª¤ï¼šæ—¥å¿—çš„åˆå§‹ç©ºçŠ¶æ€æ»¡è¶³äº†æ—¥å¿—çš„åŒ¹é…å±æ€§ï¼Œè€Œä¸€è‡´æ€§æ£€æŸ¥åˆ™ä¿ç•™äº†åªè¦æ—¥å¿—è¢«æ‰©å±•ï¼Œä¸€è‡´æ€§æ£€æŸ¥å°±ä¼šä¿ç•™æ—¥å¿—åŒ¹é…å±æ€§ã€‚å› æ­¤ï¼Œåªè¦AppendEntriesæˆåŠŸè¿”å›ã€‚é¢†å¯¼è€…çŸ¥é“è·Ÿéšè€…çš„logEntryä¸å®ƒçš„è‡ªå·±çš„logEntryç›¸åŒçš„,ç›´åˆ°æ–°çš„æ¡ç›®ã€‚</p>
</li>
<li><p>åœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œé¢†å¯¼è€…å’Œè·Ÿéšè€…çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œå› æ­¤AppendEntriesä¸€è‡´æ€§æ£€æŸ¥ä¸ä¼šå¤±è´¥ã€‚ç„¶è€Œï¼Œleaderå´©æºƒä¼šä½¿æ—¥å¿—ä¸ä¸€è‡´ï¼ˆè€leaderå¯èƒ½æ²¡æœ‰å®Œå…¨å¤åˆ¶å…¶æ—¥å¿—ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼‰ã€‚è¿™äº›ä¸ä¸€è‡´ä¼šåœ¨ä¸€ç³»åˆ—çš„é¢†å¯¼è€…å’Œè¿½éšè€…å´©æºƒä¸­åŠ å‰§ã€‚figure 7è¯´æ˜äº†è¿½éšè€…çš„æ—¥å¿—å¯èƒ½ä¸æ–°é¢†å¯¼è€…çš„æ—¥å¿—ä¸åŒçš„æ–¹å¼ã€‚è·Ÿéšè€…å¯èƒ½ä¼šç¼ºå°‘é¢†å¯¼è€…çš„æ¡ç›®ï¼Œå¯èƒ½ä¼šæœ‰é¢†å¯¼è€…æ²¡æœ‰çš„é¢å¤–æ¡ç›®ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ã€‚æ—¥å¿—ä¸­ç¼ºå¤±å’Œå¤šä½™çš„æ¡ç›®å¯èƒ½è·¨è¶Šå¤šä¸ªtermã€‚</p>
</li>
<li><p>åœ¨Raftä¸­ï¼Œé¢†å¯¼è€…é€šè¿‡å¼ºè¿«è·Ÿéšè€…é‡å¤è‡ªå·±çš„æ—¥å¿—æ¥å¤„ç†ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è·Ÿéšè€…çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—é‡å¤ã€‚è¿™æ„å‘³ç€ è·Ÿéšè€…æ—¥å¿—ä¸­çš„å†²çªæ¡ç›®å°†è¢«é¢†å¯¼è€…æ—¥å¿—ä¸­çš„æ¡ç›®è¦†ç›–ã€‚ç¬¬5.4èŠ‚å°†è¡¨æ˜è¿™å°±æ˜¯å®‰å…¨çš„ å¦‚æœå†åŠ ä¸Šä¸€ä¸ªé™åˆ¶ã€‚</p>
</li>
<li><p>ä¸ºäº†ä½¿è¿½éšè€…çš„æ—¥å¿—ä¸è‡ªå·±çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œé¢†å¯¼è€…å¿…é¡»æ‰¾åˆ°ä¸¤ä¸ªæ—¥å¿—ä¸€è‡´çš„æœ€æ–°æ—¥å¿—æ¡ç›®ï¼Œåˆ é™¤è¿½éšè€…æ—¥å¿—ä¸­æ­¤åçš„æ‰€æœ‰æ¡ç›®ï¼Œå¹¶å‘è¿½éšè€…å‘é€æ­¤åé¢†å¯¼è€…çš„æ‰€æœ‰æ¡ç›®ã€‚æ‰€æœ‰è¿™äº›åŠ¨ä½œéƒ½æ˜¯ä¸ºäº†å“åº”AppendEntries RPCsæ‰€è¿›è¡Œçš„ä¸€è‡´æ€§æ£€æŸ¥è€Œå‘ç”Ÿçš„ã€‚leaderä¸ºæ¯ä¸ªfollowerç»´æŠ¤ä¸€ä¸ªnextIndexï¼Œå®ƒæ˜¯é¢†å¯¼å°†å‘é€ç»™è¯¥è·Ÿéšè€…çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼•ã€‚å½“ä¸€ä¸ªé¢†å¯¼è€…ç¬¬ä¸€æ¬¡ä¸Šå°æ—¶ã€‚å®ƒå°†æ‰€æœ‰çš„<code>nextIndex</code>å€¼åˆå§‹åŒ–ä¸ºå…¶æ—¥å¿—ä¸­æœ€åä¸€æ¡çš„ç´¢å¼•ï¼ˆfeature 7ä¸­çš„11ï¼‰ã€‚å¦‚æœè·Ÿéšè€…çš„æ—¥å¿—ä¸é¢†å¯¼è€…çš„æ—¥å¿—ä¸ä¸€è‡´ï¼Œåœ¨ä¸‹ä¸€ä¸ªAppendEntries RPCä¸­ï¼ŒAppendEntriesä¸€è‡´æ€§æ£€æŸ¥å°†å¤±è´¥ã€‚åœ¨æ‹’ç»ä¹‹åï¼Œé¢†å¯¼è€…ä¼šå‡å°‘<code>nextIndex</code>å¹¶é‡è¯• AppendEntries RPCã€‚æœ€ç»ˆï¼Œ<code>nextIndex</code>å°†è¾¾åˆ° ä¸€ä¸ªé¢†å¯¼è€…å’Œè¿½éšè€…æ—¥å¿—åŒ¹é…çš„ç‚¹ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒAppendEntrieså°±ä¼šæˆåŠŸï¼Œè¿™å°±åˆ é™¤äº†ç§»é™¤è·Ÿéšè€…æ—¥å¿—ä¸­ä»»ä½•å†²çªçš„æ¡ç›®ï¼Œå¹¶ä»é¢†å¯¼è€…æ—¥å¿—ä¸­æ·»åŠ  ä»é¢†å¯¼è€…çš„æ—¥å¿—ä¸­æ·»åŠ æ¡ç›®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ä¸€æ—¦AppendEntries æˆåŠŸåï¼Œè·Ÿéšè€…çš„æ—¥å¿—å°±ä¸é¢†å¯¼è€…çš„ä¸€è‡´äº†ã€‚å¹¶ä¸”åœ¨ä½™ä¸‹çš„æ—¶é—´é‡Œä¿æŒè¿™ç§çŠ¶æ€ã€‚</p>
</li>
<li><p>å¦‚æœéœ€è¦ï¼Œè¯¥åè®®å¯ä»¥è¢«ä¼˜åŒ–ä»¥å‡å°‘è¢«æ‹’ç»çš„AppendEntries RPCçš„æ•°é‡ã€‚ä¾‹å¦‚ï¼Œå½“æ‹’ç»ä¸€ä¸ªAppendEntriesè¯·æ±‚æ—¶ï¼Œè·Ÿéšè€…åŒ…æ‹¬å†²çªæ¡ç›®çš„termå’Œå®ƒä¸ºè¯¥termå­˜å‚¨çš„ç¬¬ä¸€ä¸ªç´¢å¼•ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œé¢†å¯¼è€…å¯ä»¥é€’å‡ <code>nextIndex</code>ä»¥ç»•è¿‡è¯¥termä¸­çš„æ‰€æœ‰å†²çªæ¡ç›®ï¼›æ¯ä¸ªæœ‰å†²çªæ¡ç›®çš„termå°†éœ€è¦ä¸€ä¸ªAppendEntries RPCè€Œä¸æ˜¯æ¯ä¸ªlogEntryçš„RPCã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬æ€€ç–‘è¿™ç§ä¼˜åŒ–æ˜¯å¦æœ‰å¿…è¦ï¼Œå› ä¸ºæ•…éšœå‘ç”Ÿçš„é¢‘ç‡å¾ˆä½è€Œä¸”ä¸å¤ªå¯èƒ½æœ‰å¾ˆå¤šä¸ä¸€è‡´çš„æ¡ç›®ã€‚</p>
</li>
<li><p>æœ‰äº†è¿™ç§æœºåˆ¶ï¼Œé¢†å¯¼è€…ä¸éœ€è¦é‡‡å–ä»»ä½•ç‰¹åˆ«çš„è¡ŒåŠ¨æ¥æ¢å¤æ—¥å¿—çš„ä¸€è‡´æ€§ã€‚å®ƒåªæ˜¯å¼€å§‹æ­£å¸¸è¿è¡Œï¼Œè€Œæ—¥å¿—ä¼šè‡ªåŠ¨æ”¶æ•›ï¼Œä»¥åº”Append-Entriesä¸€è‡´æ€§æ£€æŸ¥çš„å¤±è´¥ã€‚ä¸€ä¸ªé¢†å¯¼è€…ä»ä¸è¦†ç›–æˆ–åˆ é™¤è‡ªå·±æ—¥å¿—ä¸­çš„æ¡ç›®ï¼ˆfigure 3ä¸­çš„ ä»…é¢†å¯¼è€…append logEntryå±æ€§ï¼‰ã€‚</p>
</li>
<li><p>è¿™ç§æ—¥å¿—å¤åˆ¶æœºåˆ¶è¡¨ç°å‡ºäº†ç¬¬2èŠ‚ä¸­æ‰€æè¿°çš„ç†æƒ³çš„å…±è¯†å±æ€§ï¼šåªè¦å¤§å¤šæ•°æœåŠ¡å™¨éƒ½åœ¨è¿è¡Œï¼ŒRaftå°±å¯ä»¥æ¥å—ã€å¤åˆ¶å’Œåº”ç”¨æ–°çš„æ—¥å¿—æ¡ç›®ï¼›åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–°æ¡ç›®å¯ä»¥é€šè¿‡å•è½®RPCså¤åˆ¶åˆ°é›†ç¾¤çš„å¤§éƒ¨åˆ†ï¼›è€Œä¸”ä¸€ä¸ªç¼“æ…¢çš„è·Ÿéšè€…ä¹Ÿä¸ä¼šå½±å“æ€§èƒ½ã€‚</p>
</li>
</ol>
<h2 id="5-4-å®‰å…¨æ€§"><a href="#5-4-å®‰å…¨æ€§" class="headerlink" title="5.4 å®‰å…¨æ€§"></a>5.4 å®‰å…¨æ€§</h2><p>ç›®å‰æ¥è¯´å·²ç»è¯´æ˜raftæ˜¯å¦‚ä½•é€‰ä¸¾å’Œå¤åˆ¶æ—¥å¿—çš„ï¼Œä½†æ˜¯è¿™å¹¶ä¸èƒ½ä¿è¯ä¸åŒçš„çŠ¶æ€æœºæ‰§è¡Œä¸åŒçš„logï¼Œ<br>è¿˜æ˜¯ä¼šå› ä¸ºfollowerè¿›å…¥ä¸å¯ç”¨çŠ¶æ€ç„¶åæ¢å¤æ´»æ€§å¹¶ç«é€‰ä¸ºleaderï¼Œè¿™æ—¶å€™leaderçš„æ—¥å¿—å°±ä¼šä¸ä¸€è‡´</p>
<h3 id="5-4-1-é€‰ä¸¾é™åˆ¶"><a href="#5-4-1-é€‰ä¸¾é™åˆ¶" class="headerlink" title="5.4.1 é€‰ä¸¾é™åˆ¶"></a>5.4.1 é€‰ä¸¾é™åˆ¶</h3><p>VSRç®—æ³•ä¸€å¼€å§‹æ—¥å¿—ä¸å…¨çš„æƒ…å†µä¸‹æˆä¸ºleaderï¼Œç„¶åå½“æŸå°æœåŠ¡å™¨æˆä¸ºleaderä¹‹åä¼šé¢å¤–çš„åŒæ­¥è¿™äº›æœªåŒæ­¥çš„æ—¥å¿—ï¼Œ<br>è€Œraftåˆ™ä¼šæ£€æŸ¥candidateå’Œfollowerçš„æ—¥å¿—ï¼Œå› ä¸ºå¦‚æœé›†ç¾¤ä¿è¯åŠæ•°nodeæäº¤æ—¥å¿—ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰åŠæ•°æœåŠ¡å™¨æ˜¯æ‹¥æœ‰<br>æœ€æ–°çš„æ—¥å¿—çš„ï¼Œä¸¤ä»½æ—¥å¿—ï¼Œä»»æœŸå·å¤§çš„æ¯”è¾ƒæ–°ï¼Œä»»æœŸå·ç›¸åŒï¼Œç´¢å¼•å¤§çš„æ¯”è¾ƒæ–°</p>
<h3 id="5-4-2-æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®"><a href="#5-4-2-æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®" class="headerlink" title="5.4.2 æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®"></a>5.4.2 æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®</h3><p>As described in Section 5.3, a leader knows that an en-<br>try from its current term is committed once that entry is<br>stored on a majority of the servers. If a leader crashes be-<br>fore committing an entry, future leaders will attempt to<br>ï¬nish replicating the entry. However, a leader cannot im-<br>mediately conclude that an entry from a previous term is<br>committed once it is stored on a majority of servers.<br>Fig-ure 8 illustrates a situation where an old log entry is stored<br>on a majority of servers, yet can still be overwritten by a<br>future leader.</p>
<p><img src="/./../../../picture/mit6.824/raft_figure_9.png" alt="figure9"></p>
<p>To eliminate problems like the one in Figure 8, Raft<br>never commits log entries from previous terms by count-<br>ing replicas. Only log entries from the leaderâ€™s current<br>term are committed by counting replicas; once an entry<br>from the current term has been committed in this way,<br>then all prior entries are committed indirectly because<br>of the Log Matching Property. There are some situations<br>where a leader could safely conclude that an older log en-<br>try is committed (for example, if that entry is stored on ev-<br>ery server), but Raft takes a more conservative approach<br>for simplicity.</p>
<p>Raft incurs(æ‹›è‡´) this extra complexity in the commitment<br>rules because log entries retain their original term num-<br>bers when a leader replicates entries from previous<br>terms. In other consensus algorithms, if a new leader re-<br>replicates entries from prior â€œterms,â€ it must do so with<br>its new â€œterm number.â€ Raftâ€™s approach makes it easier<br>to reason about log entries, since they maintain the same<br>term number over time and across logs. In addition, new<br>leaders in Raft send fewer log entries from previous terms<br>than in other algorithms (other algorithms must send re-<br>dundant log entries to renumber them before they can be<br>committed).</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/12/MIT6.824/lab2b/lab2_raft_paper/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/08/04/TED/%E5%A4%9A%E5%B7%B4%E8%83%BA%E6%88%92%E6%96%AD/"
                            aria-label=": å¤šå·´èƒºæˆ’æ–­"
                        >
                            å¤šå·´èƒºæˆ’æ–­
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-08-04T23:08:38+08:00">
	
		    Aug 04, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/TED/">TED</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>TED</p>
</blockquote>
<ol>
<li>ä¸»åŠ¨ï¼Œæœ‰æ„è¯†çš„é˜¶æ®µå¤šå·´èƒº,ç¡®å®šé‡åŒ–ç›®æ ‡</li>
<li>æ”¾ä¸‹è¿‡å»,å‘å‰çœ‹.</li>
<li>åˆ»æ„ç»ƒä¹ ï¼Œä½†æ˜¯éœ€è¦æœ‰ç¬”è®°(åº·çº³å°”ç¬”è®°)ï¼Œæœ‰æ€»ç»“ã€‚å¤§è„‘æ˜¯å¯å¡‘çš„å°±åƒï¼Œé‚£ç‰‡TEDæ¼”è®²é‚£æ ·(å›å¤´æ‰¾æ‰¾ç†æ¸…æ¥šé‡Œé¢éƒ½è®²äº†ä»€ä¹ˆ)ã€‚</li>
<li>å†¥æƒ³</li>
<li>åŠ¨æ€è°ƒæ•´,åªä¸“æ³¨åšå¥½å‡ ä»¶äº‹,ä»»åŠ¡æ˜¯å®Œæˆ</li>
<li>å…³æ³¨è‡ªæˆ‘,å…³æ³¨è‡ªæˆ‘æˆé•¿,å¤šçœ‹åˆ°è‡ªå·±çš„è¿›æ­¥,å¤šåšæœ‰ä»·å€¼çš„ä»˜å‡º,å¤šè‡ªæˆ‘åé¦ˆï¼Œå¸¦æ¥æŒç»­åŠ¨åŠ›ã€‚</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/08/04/TED/%E5%A4%9A%E5%B7%B4%E8%83%BA%E6%88%92%E6%96%AD/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 kirkzhang. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/nil" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">kirkzhang</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                nil
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-oejgoqwxqxfpwex5ev6ukctltwog5vlqaetakgrj0ys9pwba1gtnkqh5ga78.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
